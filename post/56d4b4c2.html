<!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><script></script><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3"><link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222"><meta name="keywords" content="Python,Django,在线教育平台,"><link rel="alternate" href="/atom.xml" title="mtianyan's blog" type="application/atom+xml"><meta name="description" content="数据基础决定上层建筑    设计数据库是整个项目的第一项工作:  完成django的app设计 &amp;amp; 完成app中的models设计  Django1.9.8对应github: https://github.com/mtianyan/Mxonline2Django2.0.1对应github: https://github.com/mtianyan/Mxonline3"><meta name="keywords" content="Python,Django,在线教育平台"><meta property="og:type" content="article"><meta property="og:title" content="强力Django+杀手级Xadmin打造在线教育平台(四)"><meta property="og:url" content="http://blog.mtianyan.cn/post/56d4b4c2.html"><meta property="og:site_name" content="mtianyan&#39;s blog"><meta property="og:description" content="数据基础决定上层建筑    设计数据库是整个项目的第一项工作:  完成django的app设计 &amp;amp; 完成app中的models设计  Django1.9.8对应github: https://github.com/mtianyan/Mxonline2Django2.0.1对应github: https://github.com/mtianyan/Mxonline3"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180108/DB9D66LmaJ.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180108/JJamFecfhC.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180108/i6lKIGdE93.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180108/I1fF3aL00H.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180108/3Ic2ehmkGK.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180108/8dK5e5clJB.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180108/383ceKe92C.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180108/al0KDCbiK6.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180108/628mmAGLID.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180108/GeEcJgAbEA.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180108/H6jBl0IKjb.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180108/mghmfD45hJ.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180108/JDik7FIb8k.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180108/ijGBh98JL6.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180108/79bbD88gJD.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180108/gBLe65jc53.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180108/C3h6f7d4J5.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/LedJLC8e34.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/kmDB89IcFF.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/fg4J5a2Kb5.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/8cmDm7ADf8.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/7ABfdDCf7C.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/c9eBEHb0mL.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/75hlgK7481.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/Kec5994359.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/e3081f8bJh.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/K1faIbEA3A.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/1L2lebKCl0.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/DlgdiG6K16.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/fi284KlfDk.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/5k6HkC49im.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/BHHfi6Gj2J.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/9IJa5kgFAG.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/mdib8gdGHc.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/B01J3JChmd.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/i7Cc4HHBgh.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/kE5Fc9kjc7.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/Bd16J68e9k.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/7l4AG2maAD.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/mGLjCiL8aj.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180107/IhD2bJDI6K.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/biF9eAhLHi.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/hJc05K1b28.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/BH84IH9beb.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/bbbKglA0LI.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/5ehi0hDB3C.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/8f32C0imcE.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/e60fJjHeEa.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/jg51D6Baj7.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180109/3CLeJ5LCeD.png?imageslim"><meta property="og:updated_time" content="2018-01-16T16:33:05.295Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="强力Django+杀手级Xadmin打造在线教育平台(四)"><meta name="twitter:description" content="数据基础决定上层建筑    设计数据库是整个项目的第一项工作:  完成django的app设计 &amp;amp; 完成app中的models设计  Django1.9.8对应github: https://github.com/mtianyan/Mxonline2Django2.0.1对应github: https://github.com/mtianyan/Mxonline3"><meta name="twitter:image" content="http://myphoto.mtianyan.cn/blog/180108/DB9D66LmaJ.png?imageslim"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"5.1.3",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!0,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://blog.mtianyan.cn/post/56d4b4c2.html"><script>!function(e,t,o,c,i,a,n){e.DaoVoiceObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,a=t.createElement("script"),n=t.getElementsByTagName("script")[0],a.async=1,a.src=c,a.charset="utf-8",n.parentNode.insertBefore(a,n)}(window,document,0,("https:"==document.location.protocol?"https:":"http:")+"//widget.daovoice.io/widget/0f81ff2f.js","daovoice"),daovoice("init",{app_id:"e28768be"}),daovoice("update")</script><title>强力Django+杀手级Xadmin打造在线教育平台(四) | mtianyan's blog</title><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?415372bd35fec36f7558dd96b48ec03f";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div> <a href="https://github.com/mtianyan" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">mtianyan's blog</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">天涯明月笙的博客小站(Github托管)</p></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> 归档</a></li><li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="menu-item-icon fa fa-fw fa-heartbeat"></i><br> 公益404</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br> 搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"> <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://blog.mtianyan.cn/post/56d4b4c2.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="mtianyan"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="mtianyan's blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">强力Django+杀手级Xadmin打造在线教育平台(四)</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-09T22:09:17+08:00">2018-01-09</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Django-Xadmin打造在线教育平台/" itemprop="url" rel="index"><span itemprop="name">Django+Xadmin打造在线教育平台</span></a></span></span> <span id="/post/56d4b4c2.html" class="leancloud_visitors" data-flag-title="强力Django+杀手级Xadmin打造在线教育平台(四)"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">热度&#58;</span><span class="leancloud-visitors-count"></span> <span>℃</span></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">5,590</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">24</span></div></div></header><div class="post-body" itemprop="articleBody"><blockquote class="blockquote-center"><p>数据基础决定上层建筑</p></blockquote><div class="note warning"><p> 设计数据库是整个项目的第一项工作:</p><ul><li>完成django的app设计 &amp; 完成app中的models设计</li></ul><p>Django1.9.8对应github: <a href="https://github.com/mtianyan/Mxonline2" target="_blank" rel="noopener">https://github.com/mtianyan/Mxonline2</a><br>Django2.0.1对应github: <a href="https://github.com/mtianyan/Mxonline3" target="_blank" rel="noopener">https://github.com/mtianyan/Mxonline3</a></p></div><a id="more"></a><h2 id="4-1-使用py3-6和django1-11开发系统前注意事项"><a href="#4-1-使用py3-6和django1-11开发系统前注意事项" class="headerlink" title="4-1 使用py3.6和django1.11开发系统前注意事项"></a>4-1 使用py3.6和django1.11开发系统前注意事项</h2><p>直接通过Python3.6和django最新版本来开发我们的系统的一些注意事项。</p><blockquote><p>原版本: Python 2.7 &amp; django 1.9.8<br>现在版本：Python 3.6 &amp; django 1.11</p></blockquote><p>我个人使用: 3.5 + django2.0.1 &amp; 2.7 + django 1.9.8</p><p>直接从3.6上手，开始工作，而不用做完2.7再转换。</p><blockquote><p>代码几乎100%兼容2.7 &amp; 3.6</p></blockquote><h3 id="虚拟环境问题"><a href="#虚拟环境问题" class="headerlink" title="虚拟环境问题"></a>虚拟环境问题</h3><blockquote><p>Python2.7 与 Python3.x共存并创建虚拟环境。</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkvirtualenv -p C:\...\python.exe mxonline</span><br></pre></td></tr></table></figure><h3 id="设计model的时候的-unicode-方法"><a href="#设计model的时候的-unicode-方法" class="headerlink" title="设计model的时候的__unicode__方法"></a>设计model的时候的<code>__unicode__</code>方法</h3><p>Python2.7 中:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__unicode__</span>:</span></span><br><span class="line">	<span class="keyword">return</span> self.name</span><br></pre></td></tr></table></figure><p>Python 3.x中:<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">	<span class="keyword">return</span> self.name</span><br></pre></td></tr></table></figure><p></p><blockquote><p>3.x下重载Unicode不会报错，但是会在后台显示有问题。</p></blockquote><h3 id="安装Python的mysql驱动时不能用之前的-MYSQL-python"><a href="#安装Python的mysql驱动时不能用之前的-MYSQL-python" class="headerlink" title="安装Python的mysql驱动时不能用之前的 MYSQL python"></a>安装Python的mysql驱动时不能用之前的 MYSQL python</h3><blockquote><p>这个网址是windows下python包安装的居家必备良品，建议收藏。</p></blockquote><p><a href="https://www.lfd.uci.edu/~gohlke/pythonlibs/#mysql-python" target="_blank" rel="noopener">https://www.lfd.uci.edu/~gohlke/pythonlibs/#mysql-python</a></p><p>应该改用<code>Mysqlclient</code>来替换我们的<code>MySQl-python</code></p><blockquote><p>接口是一样的。所以以后建议直接用Mysqlclient，因为它2, 3版本都有。</p></blockquote><h3 id="通过源码方式安装xadmin时。"><a href="#通过源码方式安装xadmin时。" class="headerlink" title="通过源码方式安装xadmin时。"></a>通过源码方式安装xadmin时。</h3><blockquote><p>Github 搜索 <code>mxonline_resources</code>，将里面的Xadmin放进extras_apps中。<br>就不用官方的了。</p></blockquote><p>django 2.0.1 的修复bug版可以使用我的:</p><p><a href="https://github.com/mtianyan/xadmin_django2.0.1" target="_blank" rel="noopener">https://github.com/mtianyan/xadmin_django2.0.1</a></p><blockquote><p>也可以直接使用官方的新版，已经支持了Python3.6</p></blockquote><p>Xadmin安装一定要安装依赖包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">django-crispy-forms=1.6.0</span><br><span class="line">django-import-export&gt;=0.5.1</span><br><span class="line">django-reversion~=2.0.0</span><br><span class="line">django-formtools</span><br><span class="line">future==0.15.2</span><br><span class="line">httplib2==0.9.2</span><br><span class="line">six==1.10.0</span><br></pre></td></tr></table></figure><h3 id="使用DjangoUeditor"><a href="#使用DjangoUeditor" class="headerlink" title="使用DjangoUeditor"></a>使用DjangoUeditor</h3><p>官方的不支持Python3, 去<code>mxonline_resource</code>目录下载兼容Python3的版本。<br>放入<code>extras_apps</code></p><h2 id="4-2-django-app-设计"><a href="#4-2-django-app-设计" class="headerlink" title="4-2 django-app 设计"></a>4-2 django-app 设计</h2><blockquote><p>数据库设计</p></blockquote><h3 id="根据app设计-models"><a href="#根据app设计-models" class="headerlink" title="根据app设计 models"></a>根据app设计 models</h3><h3 id="数据表生成与修改"><a href="#数据表生成与修改" class="headerlink" title="数据表生成与修改"></a>数据表生成与修改</h3><p>授课机构提供讲师录制课程，学员完成在线学习。</p><ul><li>全局头部：用户消息 &amp; 个人中心: 没有登录时，就是登录注册</li><li>对于公开课，授课讲师，授课机构进行搜索。</li><li>轮播图，课程，机构，页脚</li><li>公开课：分页公开课，右边热门推荐。</li><li>点进课程：课程详情页。详情: 后台富文本。右边是课程机构的介绍。收藏 或学习</li><li>章节信息 &amp; 课程资源下载 &amp; 评论</li><li>授课讲师: 授课讲师列表页, 讲师排行榜。分页。</li><li>点进讲师: 看到课程。</li><li>授课机构: 类别筛选，机构性质，所在地区 &amp; 排序。用户提交表单，我要学习, 机构排名.</li><li>个人中心: 修改密码, 修改头像, 个人信息, 我的课程, 我的收藏, 我的消息。</li></ul><p>app大致会有<code>用户模块</code>,<code>课程模块</code>,<code>授课教师</code>与<code>授课机构</code>。</p><p><img src="http://myphoto.mtianyan.cn/blog/180108/DB9D66LmaJ.png?imageslim" alt="mark"></p><p>多一个operation app 是因为数据库的需要。后面会讲。</p><h2 id="4-3-新建项目"><a href="#4-3-新建项目" class="headerlink" title="4-3 新建项目"></a>4-3 新建项目</h2><h3 id="Python2-7-创建虚拟环境。"><a href="#Python2-7-创建虚拟环境。" class="headerlink" title="Python2.7 创建虚拟环境。"></a>Python2.7 创建虚拟环境。</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkvirtualenv mxonline2</span><br></pre></td></tr></table></figure><p>安装django</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install django==1.9.8</span><br></pre></td></tr></table></figure><blockquote><p>注意Python2下此处必须用1.9.8</p></blockquote><p><img src="http://myphoto.mtianyan.cn/blog/180108/JJamFecfhC.png?imageslim" alt="mark"></p><h3 id="Python3-x-创建虚拟环境"><a href="#Python3-x-创建虚拟环境" class="headerlink" title="Python3.x 创建虚拟环境"></a>Python3.x 创建虚拟环境</h3><p>如果你已经通过我的博文《Python开发环境搭建指南(Anaconda2,3共存)》<br>搭建了完美的共存环境使用下面命令创建虚拟环境</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkvirtualenv -p D:\softEnvDown\Anaconda2\envs\py3\python.exe mxonline3</span><br></pre></td></tr></table></figure><blockquote><p>-p后面路径为自己的Python3的exe文件路径。</p></blockquote><p><img src="http://myphoto.mtianyan.cn/blog/180108/i6lKIGdE93.png?imageslim" alt="mark"></p><blockquote><p>官方说明的最新稳定版为2.0.1(2018-01-08 19:37:06)</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">workon mxonline3</span><br><span class="line">pip install django==2.0.1</span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180108/I1fF3aL00H.png?imageslim" alt="mark"></p><p>至此我们的两个虚拟环境都已经准备好了。</p><h3 id="新建Python2-下Project"><a href="#新建Python2-下Project" class="headerlink" title="新建Python2 下Project"></a>新建Python2 下Project</h3><p>为Mxonline2 配置环境 <code>mxonline2</code></p><p><img src="http://myphoto.mtianyan.cn/blog/180108/3Ic2ehmkGK.png?imageslim" alt="mark"></p><p>注意一直定位到Python.exe。</p><h4 id="安装mysql驱动。"><a href="#安装mysql驱动。" class="headerlink" title="安装mysql驱动。"></a>安装mysql驱动。</h4><p>下载<a href="https://www.lfd.uci.edu/~gohlke/pythonlibs/#mysql-python中" target="_blank" rel="noopener">https://www.lfd.uci.edu/~gohlke/pythonlibs/#mysql-python中</a><br>mysqlclient‑1.3.12‑cp34‑cp34m‑win_amd64.whl进行本地安装</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">workon mxonline2</span><br><span class="line">pip install mysqlclient-1.3.12-cp27-cp27m-win_amd64.whl</span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180108/8dK5e5clJB.png?imageslim" alt="mark"></p><h3 id="新建Python3-下Project"><a href="#新建Python3-下Project" class="headerlink" title="新建Python3 下Project"></a>新建Python3 下Project</h3><p>为Mxonline3 配置环境 <code>mxonline3</code></p><p><img src="http://myphoto.mtianyan.cn/blog/180108/383ceKe92C.png?imageslim" alt="mark"></p><blockquote><p>注意一直定位到Python.exe。</p></blockquote><h4 id="安装mysql驱动。-1"><a href="#安装mysql驱动。-1" class="headerlink" title="安装mysql驱动。"></a>安装mysql驱动。</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">workon mxonline3</span><br><span class="line">pip install mysqlclient</span><br></pre></td></tr></table></figure><h3 id="setting中配置"><a href="#setting中配置" class="headerlink" title="setting中配置"></a>setting中配置</h3><p>Mxonline2/settings.py:<br>Mxonline3/settings.py:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line">    &apos;default&apos;: &#123;</span><br><span class="line">        &apos;ENGINE&apos;: &apos;django.db.backends.mysql&apos;,</span><br><span class="line">        &apos;NAME&apos;: &apos;mxonline2&apos;,</span><br><span class="line">        &apos;USER&apos;: &apos;root&apos;,</span><br><span class="line">        &apos;PASSWORD&apos;: &apos;你的密码&apos;,</span><br><span class="line">        &apos;HOST&apos;:&apos;127.0.0.1&apos;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line">    &apos;default&apos;: &#123;</span><br><span class="line">        &apos;ENGINE&apos;: &apos;django.db.backends.mysql&apos;,</span><br><span class="line">        &apos;NAME&apos;: &apos;mxonline3&apos;,</span><br><span class="line">        &apos;USER&apos;: &apos;root&apos;,</span><br><span class="line">        &apos;PASSWORD&apos;: &apos;你的密码&apos;,</span><br><span class="line">        &apos;HOST&apos;:&apos;127.0.0.1&apos;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="前往Navicat新建数据库"><a href="#前往Navicat新建数据库" class="headerlink" title="前往Navicat新建数据库"></a>前往Navicat新建数据库</h3><p>mxonline2 &amp; mxonline3</p><h4 id="进行数据库初始化makemigrations"><a href="#进行数据库初始化makemigrations" class="headerlink" title="进行数据库初始化makemigrations"></a>进行数据库初始化makemigrations</h4><p>点击<code>Tools 菜单下 Run manage.py Task</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">makemigrations</span><br><span class="line">migrate</span><br></pre></td></tr></table></figure><blockquote><p>2,3操作一致</p></blockquote><p>点击 RUn edit</p><p><img src="http://myphoto.mtianyan.cn/blog/180108/al0KDCbiK6.png?imageslim" alt="mark"></p><p>可以为2,3配置不同的port。比如2: 8002 &amp; 3: 8003</p><p>2: 点击run运行: django1.9.8成功画面如下。</p><p><img src="http://myphoto.mtianyan.cn/blog/180108/628mmAGLID.png?imageslim" alt="mark"></p><p>3: 点击run运行: django2.0.1成功画面如下。</p><p><img src="http://myphoto.mtianyan.cn/blog/180108/GeEcJgAbEA.png?imageslim" alt="mark"></p><p>这时我们的项目就新建成功。</p><p>此处对应commit:</p><blockquote><p>项目初始化成功: 完成数据库Migration初始化。 对应4-3</p></blockquote><h2 id="4-4-自定义userprofile"><a href="#4-4-自定义userprofile" class="headerlink" title="4-4 自定义userprofile"></a>4-4 自定义userprofile</h2><p>点击<code>Tools 菜单下 Run manage.py Task</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">startapp users</span><br></pre></td></tr></table></figure><h3 id="编写我们的model设计user表。"><a href="#编写我们的model设计user表。" class="headerlink" title="编写我们的model设计user表。"></a>编写我们的model设计user表。</h3><p>系统自动生成的user表如下:</p><p><img src="http://myphoto.mtianyan.cn/blog/180108/H6jBl0IKjb.png?imageslim" alt="mark"></p><ul><li>id: 主键, password 密码, last_login Django自动记录用户最后登录时间,。</li><li>is_superuser 表明用户是否是超级用户(后台管理会用到)。</li><li>username 用户名字段不要随便改动, email 邮箱,</li><li>is_staff 表示是否是员工(后台管理会用到)。</li><li>is_active 用户是否是激活状态, date_joined 注册时间。</li></ul><blockquote><p>我们需要扩展我们自己的需求字段。</p></blockquote><p>个人中心页面中:</p><p><img src="http://myphoto.mtianyan.cn/blog/180108/mghmfD45hJ.png?imageslim" alt="mark"></p><p>可以看到我们还需要的有：</p><ul><li>昵称: nickname</li><li>生日: birthday</li><li>性别: gender</li></ul><p>User表的自定义方法可以查看django官方文档。<br>我们既想保留原有字段，又想有新字段。</p><p>users/models.py(3把Unicode改为str)添加代码:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> AbstractUser</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserProfile</span><span class="params">(AbstractUser)</span>:</span></span><br><span class="line">    <span class="comment"># 自定义的性别选择规则</span></span><br><span class="line">    GENDER_CHOICES = (</span><br><span class="line">        (<span class="string">"male"</span>, <span class="string">u"男"</span>),</span><br><span class="line">        (<span class="string">"female"</span>, <span class="string">u"女"</span>)</span><br><span class="line">    )</span><br><span class="line">    <span class="comment"># 昵称</span></span><br><span class="line">    nick_name = models.CharField(max_length=<span class="number">50</span>, verbose_name=<span class="string">u"昵称"</span>, default=<span class="string">""</span>)</span><br><span class="line">    <span class="comment"># 生日，可以为空</span></span><br><span class="line">    birthday = models.DateField(verbose_name=<span class="string">u"生日"</span>, null=<span class="keyword">True</span>, blank=<span class="keyword">True</span>)</span><br><span class="line">    <span class="comment"># 性别 只能男或女，默认女</span></span><br><span class="line">    gender = models.CharField(</span><br><span class="line">        max_length=<span class="number">5</span>,</span><br><span class="line">        verbose_name=<span class="string">u"性别"</span>,</span><br><span class="line">        choices=GENDER_CHOICES,</span><br><span class="line">        default=<span class="string">"female"</span>)</span><br><span class="line">    <span class="comment"># 地址</span></span><br><span class="line">    address = models.CharField(max_length=<span class="number">100</span>, verbose_name=<span class="string">"地址"</span>, default=<span class="string">""</span>)</span><br><span class="line">    <span class="comment"># 电话</span></span><br><span class="line">    mobile = models.CharField(max_length=<span class="number">11</span>, null=<span class="keyword">True</span>, blank=<span class="keyword">True</span>)</span><br><span class="line">    <span class="comment"># 头像 默认使用default.png</span></span><br><span class="line">    image = models.ImageField(</span><br><span class="line">        upload_to=<span class="string">"image/%Y/%m"</span>,</span><br><span class="line">        default=<span class="string">u"image/default.png"</span>,</span><br><span class="line">        max_length=<span class="number">100</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># meta信息，即后台栏目名</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        verbose_name = <span class="string">"用户信息"</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 重载Unicode方法，打印实例会打印username，username为继承自abstractuser</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__unicode__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.username</span><br></pre></td></tr></table></figure><p>点进<code>AbstractUser</code>可以看到这个models里面就有我们默认表的那些字段。</p><p>因为Image字段需要用到<code>pillow</code>所以需要安装该库</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pillow</span><br></pre></td></tr></table></figure><p><strong>注意：CharField必须有max_length, Imagefield实际也是charfield所以也要有max_length</strong></p><h4 id="setting设置INSTALLED-APPS-amp-AUTH-USER-MODEL。"><a href="#setting设置INSTALLED-APPS-amp-AUTH-USER-MODEL。" class="headerlink" title="setting设置INSTALLED_APPS &amp; AUTH_USER_MODEL。"></a>setting设置INSTALLED_APPS &amp; AUTH_USER_MODEL。</h4><ul><li>INSTALLED_APPS注册app</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos;users&apos;</span><br></pre></td></tr></table></figure><ul><li>重载AUTH_USER_MODEL</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 此处重载是为了使我们的UserProfile生效</span><br><span class="line">AUTH_USER_MODEL = &quot;users.UserProfile&quot;</span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180108/JDik7FIb8k.png?imageslim" alt="mark"></p><p>点击<code>Tools 菜单下 Run manage.py Task</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">makemigrations users</span><br><span class="line">migrate users</span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180108/ijGBh98JL6.png?imageslim" alt="mark"></p><blockquote><p>上图中可以看到数据库做出的改动。输入: yes</p></blockquote><h3 id="进入Navicat进行验证"><a href="#进入Navicat进行验证" class="headerlink" title="进入Navicat进行验证"></a>进入Navicat进行验证</h3><p><img src="http://myphoto.mtianyan.cn/blog/180108/79bbD88gJD.png?imageslim" alt="mark"></p><p>如上图可以看到我们的表已经生成成功。</p><h3 id="附加Python3下不同与报错："><a href="#附加Python3下不同与报错：" class="headerlink" title="附加Python3下不同与报错："></a>附加Python3下不同与报错：</h3><p>将Unicode方法改为str方法<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 重载__str__方法，打印实例会打印username，username为继承自AbstractUser</span><br><span class="line">def __str__(self):</span><br><span class="line">    return self.username</span><br></pre></td></tr></table></figure><p></p><p>报错:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">django.db.migrations.exceptions.InconsistentMigrationHistory: Migration</span><br><span class="line">admin.0001_initial is applied before its dependency users.0001_initial on</span><br><span class="line">database &apos;default&apos;</span><br></pre></td></tr></table></figure><p>解决方案:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">删除数据库中 除了auth_user的其他表</span><br></pre></td></tr></table></figure><p>然后执行命令:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">makemigrations</span><br><span class="line">migrate</span><br><span class="line">makemigrations users</span><br><span class="line">migrate users</span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180108/gBLe65jc53.png?imageslim" alt="mark"></p><blockquote><p>共11张表，同期django1.9.8会产生13张表</p></blockquote><p><img src="http://myphoto.mtianyan.cn/blog/180108/C3h6f7d4J5.png?imageslim" alt="mark"></p><blockquote><p>我推测是因为在django2.0版本中。我们如果自定义了userProfile并且在setting中进行了设置。那么auth_user将不再拥有多的表。</p></blockquote><p>下次不要再初始化时执行makemigrations &amp; migrate。当我们设计userProfile完成之后再执行。</p><p>本小节完成对应commit:</p><blockquote><p>完成USerProfile models书写。makemigrations &amp; migrate 建表成功。对应4-4</p></blockquote><h2 id="4-5-user-modesl-py设计"><a href="#4-5-user-modesl-py设计" class="headerlink" title="4-5 user modesl.py设计"></a>4-5 user modesl.py设计</h2><p>循环引用:</p><blockquote><p>设计app时每个app都有model</p></blockquote><p><img src="http://myphoto.mtianyan.cn/blog/180109/LedJLC8e34.png?imageslim" alt="mark"></p><p>如图：我们在user中定义usercourse记录用户学习的课程。会有两个外键：user和course。<br>我们就会<code>import Courses.models</code></p><p>如果用户对课程的评论：会放在 <code>Courses.models</code>当中。评论我们需要保存相应的用户。<br>我们就会<code>import User.models</code></p><p>循环import会出错。a与b相互调用，造成等待。</p><h3 id="解决循环引用-分层设计"><a href="#解决循环引用-分层设计" class="headerlink" title="解决循环引用: 分层设计"></a>解决循环引用: 分层设计</h3><p>目前已有app：users courses organization</p><p>另外一个app高于这些app的层级。<code>operation</code>.上一层app可以import下层的app。</p><p><img src="http://myphoto.mtianyan.cn/blog/180109/kmDB89IcFF.png?imageslim" alt="mark"></p><p>上节中: 自定义<code>userprofile</code> 覆盖默认<code>user</code>表</p><p>user中还需要添加的(前提是这些功能比较独立):</p><ul><li>EmailVerifyRecord - 邮箱验证码</li><li>PageBanner - 轮播图</li></ul><p>观察轮播图:</p><blockquote><ol><li>图片 2. 点击图片地址 3. 轮播图序号(控制前后)</li></ol></blockquote><p><img src="http://myphoto.mtianyan.cn/blog/180109/fg4J5a2Kb5.png?imageslim" alt="mark"></p><p>users/models.py中添加代码:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="comment"># 邮箱验证码model</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EmailVerifyRecord</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    SEND_CHOICES = (</span><br><span class="line">        (<span class="string">"register"</span>, <span class="string">u"注册"</span>),</span><br><span class="line">        (<span class="string">"forget"</span>, <span class="string">u"找回密码"</span>)</span><br><span class="line">    )</span><br><span class="line">    code = models.CharField(max_length=<span class="number">20</span>, verbose_name=<span class="string">u"验证码"</span>)</span><br><span class="line">    <span class="comment"># 未设置null = true blank = true 默认不可为空</span></span><br><span class="line">    email = models.EmailField(max_length=<span class="number">50</span>, verbose_name=<span class="string">u"邮箱"</span>)</span><br><span class="line">    send_type = models.CharField(choices=SEND_CHOICES, max_length=<span class="number">10</span>)</span><br><span class="line">    <span class="comment"># 这里的now得去掉(),不去掉会根据编译时间。而不是根据实例化时间。</span></span><br><span class="line">    send_time = models.DateTimeField(default=datetime.now)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        verbose_name = <span class="string">"邮箱验证码"</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br><span class="line"></span><br><span class="line"><span class="comment"># 轮播图model</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Banner</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    title = models.CharField(max_length=<span class="number">100</span>, verbose_name=<span class="string">u"标题"</span>)</span><br><span class="line">    image = models.ImageField(</span><br><span class="line">        upload_to=<span class="string">"banner/%Y/%m"</span>,</span><br><span class="line">        verbose_name=<span class="string">u"轮播图"</span>,</span><br><span class="line">        max_length=<span class="number">100</span>)</span><br><span class="line">    url = models.URLField(max_length=<span class="number">200</span>, verbose_name=<span class="string">u"访问地址"</span>)</span><br><span class="line">    <span class="comment"># 默认index很大靠后。想要靠前修改index值。</span></span><br><span class="line">    index = models.IntegerField(default=<span class="number">100</span>, verbose_name=<span class="string">u"顺序"</span>)</span><br><span class="line">    add_time = models.DateTimeField(default=datetime.now, verbose_name=<span class="string">u"添加时间"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        verbose_name = <span class="string">u"轮播图"</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br></pre></td></tr></table></figure><p>从上往下: 第一块区域import官方包，第二块import第三方。(PEP8)</p><p><img src="http://myphoto.mtianyan.cn/blog/180109/8cmDm7ADf8.png?imageslim" alt="mark"></p><p>如下图: 我们一共创建了三个数据表: Structure可以查看到</p><p><img src="http://myphoto.mtianyan.cn/blog/180109/7ABfdDCf7C.png?imageslim" alt="mark"></p><blockquote><p>与用户相关的评论啊，点赞啊。学习的课程啊并没有放进来，因为那些独立性不高。<br>容易产生循环引用。我们把那些放到operation中。</p></blockquote><p>本小节完成，对应commit:</p><blockquote><p>Usermodel添加邮箱验证码，首页轮播图。对应4-5</p></blockquote><h2 id="4-6-course-models-py编写"><a href="#4-6-course-models-py编写" class="headerlink" title="4-6 course models.py编写"></a>4-6 course models.py编写</h2><p>点击 <code>Tools 菜单下 Run manage.py Task</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">startapp courses</span><br></pre></td></tr></table></figure><p>course中需要那些表:</p><ul><li>课程本身需要一张表</li></ul><p><img src="http://myphoto.mtianyan.cn/blog/180109/c9eBEHb0mL.png?imageslim" alt="mark"></p><p><img src="http://myphoto.mtianyan.cn/blog/180109/75hlgK7481.png?imageslim" alt="mark"></p><ul><li><p>点进去之后点击开始学习。</p></li><li><p>课程基本信息需要一张表, 章节表与课程表存在(一个课程对应多个章节)</p></li><li>章节表中：章节的名称。 章节与视频(一个章节对应多个视频)</li></ul><p>结构: 课程本身–(一对多)&gt;章节-(一对多)-&gt;视频信息</p><p>资源下载放在课程里面的。一个课程对应多个资源</p><p>共四张表：课程本身–(一对多)&gt;章节-(一对多)-&gt;视频信息 &amp; 资源表</p><p><img src="http://myphoto.mtianyan.cn/blog/180109/Kec5994359.png?imageslim" alt="mark"></p><p>courses/models.py:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="comment"># 课程信息表</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Course</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    DEGREE_CHOICES = (</span><br><span class="line">        (<span class="string">"cj"</span>, <span class="string">u"初级"</span>),</span><br><span class="line">        (<span class="string">"zj"</span>, <span class="string">u"中级"</span>),</span><br><span class="line">        (<span class="string">"gj"</span>, <span class="string">u"高级"</span>)</span><br><span class="line">    )</span><br><span class="line">    name = models.CharField(max_length=<span class="number">50</span>, verbose_name=<span class="string">u"课程名"</span>)</span><br><span class="line">    desc = models.CharField(max_length=<span class="number">300</span>, verbose_name=<span class="string">u"课程描述"</span>)</span><br><span class="line">    <span class="comment"># TextField允许我们不输入长度。可以输入到无限大。暂时定义为TextFiled，之后更新为富文本</span></span><br><span class="line">    detail = models.TextField(verbose_name=<span class="string">u"课程详情"</span>)</span><br><span class="line">    degree = models.CharField(choices=DEGREE_CHOICES, max_length=<span class="number">2</span>)</span><br><span class="line">    <span class="comment"># 使用分钟做后台记录(存储最小单位)前台转换</span></span><br><span class="line">    learn_times = models.IntegerField(default=<span class="number">0</span>, verbose_name=<span class="string">u"学习时长(分钟数)"</span>)</span><br><span class="line">    <span class="comment"># 保存学习人数:点击开始学习才算</span></span><br><span class="line">    students = models.IntegerField(default=<span class="number">0</span>, verbose_name=<span class="string">u"学习人数"</span>)</span><br><span class="line">    fav_nums = models.IntegerField(default=<span class="number">0</span>, verbose_name=<span class="string">u"收藏人数"</span>)</span><br><span class="line">    image = models.ImageField(</span><br><span class="line">        upload_to=<span class="string">"courses/%Y/%m"</span>,</span><br><span class="line">        verbose_name=<span class="string">u"封面图"</span>,</span><br><span class="line">        max_length=<span class="number">100</span>)</span><br><span class="line">    <span class="comment"># 保存点击量，点进页面就算</span></span><br><span class="line">    click_nums = models.IntegerField(default=<span class="number">0</span>, verbose_name=<span class="string">u"点击数"</span>)</span><br><span class="line">    add_time = models.DateTimeField(default=datetime.now, verbose_name=<span class="string">u"添加时间"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        verbose_name = <span class="string">u"课程"</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br></pre></td></tr></table></figure><p>下面来编写章节 &amp; 视频 &amp; 课程资源:<code>courses/models.py</code></p><p>一对多, 多对一都可以使用django的外键来完成。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 章节</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Lesson</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="comment"># 因为一个课程对应很多章节。所以在章节表中将课程设置为外键。</span></span><br><span class="line">    <span class="comment"># 作为一个字段来让我们可以知道这个章节对应那个课程</span></span><br><span class="line">    course = models.ForeignKey(Course, verbose_name=<span class="string">u"课程"</span>)</span><br><span class="line">    name = models.CharField(max_length=<span class="number">100</span>, verbose_name=<span class="string">u"章节名"</span>)</span><br><span class="line">    add_time = models.DateTimeField(default=datetime.now, verbose_name=<span class="string">u"添加时间"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        verbose_name = <span class="string">u"章节"</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 每章视频</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Video</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="comment"># 因为一个章节对应很多视频。所以在视频表中将章节设置为外键。</span></span><br><span class="line">    <span class="comment"># 作为一个字段来存储让我们可以知道这个视频对应哪个章节.</span></span><br><span class="line">    lesson = models.ForeignKey(Lesson, verbose_name=<span class="string">u"章节"</span>)</span><br><span class="line">    name = models.CharField(max_length=<span class="number">100</span>, verbose_name=<span class="string">u"视频名"</span>)</span><br><span class="line">    add_time = models.DateTimeField(default=datetime.now, verbose_name=<span class="string">u"添加时间"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        verbose_name = <span class="string">u"视频"</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 课程资源</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CourseResource</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="comment"># 因为一个课程对应很多资源。所以在课程资源表中将课程设置为外键。</span></span><br><span class="line">    <span class="comment"># 作为一个字段来让我们可以知道这个资源对应那个课程</span></span><br><span class="line">    course = models.ForeignKey(Course, verbose_name=<span class="string">u"课程"</span>)</span><br><span class="line">    name = models.CharField(max_length=<span class="number">100</span>, verbose_name=<span class="string">u"名称"</span>)</span><br><span class="line">    <span class="comment"># 这里定义成文件类型的field，后台管理系统中会直接有上传的按钮。</span></span><br><span class="line">    <span class="comment"># FileField也是一个字符串类型，要指定最大长度。</span></span><br><span class="line">    download = models.FileField(</span><br><span class="line">        upload_to=<span class="string">"course/resource/%Y/%m"</span>,</span><br><span class="line">        verbose_name=<span class="string">u"资源文件"</span>,</span><br><span class="line">        max_length=<span class="number">100</span>)</span><br><span class="line">    add_time = models.DateTimeField(default=datetime.now, verbose_name=<span class="string">u"添加时间"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        verbose_name = <span class="string">u"课程资源"</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br></pre></td></tr></table></figure><p>通过Structure可以看到我们刚才设计的四张表</p><p><img src="http://myphoto.mtianyan.cn/blog/180109/e3081f8bJh.png?imageslim" alt="mark"></p><p>本小节完毕, 对应commit:</p><blockquote><p>设计完成课程app中四张数据表: 课程，章节，视频，资源。对应4-6</p></blockquote><h2 id="4-7-organization-modesl-py设计"><a href="#4-7-organization-modesl-py设计" class="headerlink" title="4-7 organization modesl.py设计"></a>4-7 organization modesl.py设计</h2><p>新建课程机构app:</p><p>点击<code>Tools 菜单下 Run manage.py Task</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">startapp organization</span><br></pre></td></tr></table></figure><p>课程是属于机构的, 机构有机构类别，城市等字段。讲师实体。<br>我要学习的提交表单会与用户关联，存放在机构。</p><p><img src="http://myphoto.mtianyan.cn/blog/180109/K1faIbEA3A.png?imageslim" alt="mark"></p><p><img src="http://myphoto.mtianyan.cn/blog/180109/1L2lebKCl0.png?imageslim" alt="mark"></p><p>其中课程数，学习人数可以动态统计。机构地址，机构经典课程。</p><blockquote><p>机构讲师，机构课程可以通过外键获取到, 不保存到机构中。</p></blockquote><p><img src="http://myphoto.mtianyan.cn/blog/180109/DlgdiG6K16.png?imageslim" alt="mark"></p><blockquote><p>讲师大概所需要的字段如图所示。</p></blockquote><p>organization/models.py 代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding : utf-8</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 城市字典</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CityDict</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">20</span>, verbose_name=<span class="string">u"城市"</span>)</span><br><span class="line">    <span class="comment"># 城市描述：备用不一定展示出来</span></span><br><span class="line">    desc = models.CharField(max_length=<span class="number">200</span>, verbose_name=<span class="string">u"描述"</span>)</span><br><span class="line">    add_time = models.DateTimeField(default=datetime.now, verbose_name=<span class="string">u"添加时间"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        verbose_name = <span class="string">u"城市"</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 课程机构</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CourseOrg</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">50</span>, verbose_name=<span class="string">u"机构名称"</span>)</span><br><span class="line">    <span class="comment"># 机构描述，后面会替换为富文本展示</span></span><br><span class="line">    desc = models.TextField(verbose_name=<span class="string">u"机构描述"</span>)</span><br><span class="line">    click_nums = models.IntegerField(default=<span class="number">0</span>, verbose_name=<span class="string">u"点击数"</span>)</span><br><span class="line">    fav_nums = models.IntegerField(default=<span class="number">0</span>, verbose_name=<span class="string">u"收藏数"</span>)</span><br><span class="line">    image = models.ImageField(</span><br><span class="line">        upload_to=<span class="string">"org/%Y/%m"</span>,</span><br><span class="line">        verbose_name=<span class="string">u"封面图"</span>,</span><br><span class="line">        max_length=<span class="number">100</span>)</span><br><span class="line">    address = models.CharField(max_length=<span class="number">150</span>, verbose_name=<span class="string">u"机构地址"</span>)</span><br><span class="line">    <span class="comment"># 一个城市可以有很多课程机构，通过将city设置外键，变成课程机构的一个字段</span></span><br><span class="line">    <span class="comment"># 可以让我们通过机构找到城市</span></span><br><span class="line">    city = models.ForeignKey(CityDict, verbose_name=<span class="string">u"所在城市"</span>)</span><br><span class="line">    add_time = models.DateTimeField(default=datetime.now, verbose_name=<span class="string">u"添加时间"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        verbose_name = <span class="string">u"课程机构"</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 讲师</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Teacher</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="comment"># 一个机构会有很多老师，所以我们在讲师表添加外键并把课程机构名称保存下来</span></span><br><span class="line">    <span class="comment"># 可以使我们通过讲师找到对应的机构</span></span><br><span class="line">    org = models.ForeignKey(CourseOrg, verbose_name=<span class="string">u"所属机构"</span>)</span><br><span class="line">    name = models.CharField(max_length=<span class="number">50</span>, verbose_name=<span class="string">u"教师名称"</span>)</span><br><span class="line">    work_years = models.IntegerField(default=<span class="number">0</span>, verbose_name=<span class="string">u"工作年限"</span>)</span><br><span class="line">    work_company = models.CharField(max_length=<span class="number">50</span>, verbose_name=<span class="string">u"就职公司"</span>)</span><br><span class="line">    work_position = models.CharField(max_length=<span class="number">50</span>, verbose_name=<span class="string">u"公司职位"</span>)</span><br><span class="line">    points = models.CharField(max_length=<span class="number">50</span>, verbose_name=<span class="string">u"教学特点"</span>)</span><br><span class="line">    click_nums = models.IntegerField(default=<span class="number">0</span>, verbose_name=<span class="string">u"点击数"</span>)</span><br><span class="line">    fav_nums = models.IntegerField(default=<span class="number">0</span>, verbose_name=<span class="string">u"收藏数"</span>)</span><br><span class="line">    add_time = models.DateTimeField(default=datetime.now, verbose_name=<span class="string">u"添加时间"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        verbose_name = <span class="string">u"教师"</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180109/fi284KlfDk.png?imageslim" alt="mark"></p><blockquote><p>可以看到我们一共创建了三张表：分别是城市，课程机构，讲师。</p></blockquote><p>本小节对应commit:</p><blockquote><p>课程机构app：城市，机构，讲师表书写完毕。对应4-7</p></blockquote><h2 id="4-8-operation-models-py设计"><a href="#4-8-operation-models-py设计" class="headerlink" title="4-8 operation models.py设计"></a>4-8 operation models.py设计</h2><p>分析需要那些表:</p><ul><li>用户可以提交我要学习的个人需求。</li><li>学员的课程评论信息</li><li>收藏：可以收藏公开课, 授课讲师, 授课机构, 用户消息提醒。</li><li>个人中心：我的课程说明用户和课程之间的学习关系也需要保存。</li></ul><p><img src="http://myphoto.mtianyan.cn/blog/180109/5k6HkC49im.png?imageslim" alt="mark"></p><p>新建操作app:</p><p>点击<code>Tools 菜单下 Run manage.py Task</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">startapp operation</span><br></pre></td></tr></table></figure><p>operation/models.py添加代码:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="comment"># 引入我们CourseComments所需要的外键models</span></span><br><span class="line"><span class="keyword">from</span> users.models <span class="keyword">import</span> UserProfile</span><br><span class="line"><span class="keyword">from</span> courses.models <span class="keyword">import</span> Course</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户我要学习表单</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserAsk</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">20</span>, verbose_name=<span class="string">u"姓名"</span>)</span><br><span class="line">    mobile = models.CharField(max_length=<span class="number">11</span>, verbose_name=<span class="string">u"手机"</span>)</span><br><span class="line">    course_name = models.CharField(max_length=<span class="number">50</span>, verbose_name=<span class="string">u"课程名"</span>)</span><br><span class="line">    add_time = models.DateTimeField(default=datetime.now, verbose_name=<span class="string">u"添加时间"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        verbose_name = <span class="string">u"用户咨询"</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户对于课程评论</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CourseComments</span><span class="params">(models.Model)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 会涉及两个外键: 1. 用户， 2. 课程。import进来</span></span><br><span class="line">    course = models.ForeignKey(Course, verbose_name=<span class="string">u"课程"</span>)</span><br><span class="line">    user = models.ForeignKey(UserProfile, verbose_name=<span class="string">u"用户"</span>)</span><br><span class="line">    comments = models.CharField(max_length=<span class="number">250</span>, verbose_name=<span class="string">u"评论"</span>)</span><br><span class="line">    add_time = models.DateTimeField(default=datetime.now, verbose_name=<span class="string">u"评论时间"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        verbose_name = <span class="string">u"课程评论"</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户对于课程,机构，讲师的收藏</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserFavorite</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="comment"># 会涉及四个外键。用户，课程，机构，讲师import</span></span><br><span class="line">    TYPE_CHOICES = (</span><br><span class="line">        (<span class="number">1</span>, <span class="string">u"课程"</span>),</span><br><span class="line">        (<span class="number">2</span>, <span class="string">u"课程机构"</span>),</span><br><span class="line">        (<span class="number">3</span>, <span class="string">u"讲师"</span>)</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    user = models.ForeignKey(UserProfile, verbose_name=<span class="string">u"用户"</span>)</span><br><span class="line">    <span class="comment"># course = models.ForeignKey(Course, verbose_name=u"课程")</span></span><br><span class="line">    <span class="comment"># teacher = models.ForeignKey()</span></span><br><span class="line">    <span class="comment"># org = models.ForeignKey()</span></span><br><span class="line">    <span class="comment"># fav_type =</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 机智版</span></span><br><span class="line">    <span class="comment"># 直接保存用户的id.</span></span><br><span class="line">    fav_id = models.IntegerField(default=<span class="number">0</span>)</span><br><span class="line">    <span class="comment"># 表明收藏的是哪种类型。</span></span><br><span class="line">    fav_type = models.IntegerField(</span><br><span class="line">        choices=TYPE_CHOICES,</span><br><span class="line">        default=<span class="number">1</span>,</span><br><span class="line">        verbose_name=<span class="string">u"收藏类型"</span>)</span><br><span class="line">    add_time = models.DateTimeField(default=datetime.now, verbose_name=<span class="string">u"评论时间"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        verbose_name = <span class="string">u"用户收藏"</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户消息表</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserMessage</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">        <span class="comment"># 因为我们的消息有两种:发给全员和发给某一个用户。</span></span><br><span class="line">        <span class="comment"># 所以如果使用外键，每个消息会对应要有用户。很难实现全员消息。</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 机智版 为0发给所有用户，不为0就是发给用户的id</span></span><br><span class="line">    user = models.IntegerField(default=<span class="number">0</span>, verbose_name=<span class="string">u"接收用户"</span>)</span><br><span class="line">    message = models.CharField(max_length=<span class="number">500</span>, verbose_name=<span class="string">u"消息内容"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 是否已读: 布尔类型 BooleanField False未读,True表示已读</span></span><br><span class="line">    has_read = models.BooleanField(default=<span class="keyword">False</span>, verbose_name=<span class="string">u"是否已读"</span>)</span><br><span class="line">    add_time = models.DateTimeField(default=datetime.now, verbose_name=<span class="string">u"添加时间"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        verbose_name = <span class="string">u"用户消息"</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户课程表</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserCourse</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="comment"># 会涉及两个外键: 1. 用户， 2. 课程。import进来</span></span><br><span class="line">    course = models.ForeignKey(Course, verbose_name=<span class="string">u"课程"</span>)</span><br><span class="line">    user = models.ForeignKey(UserProfile, verbose_name=<span class="string">u"用户"</span>)</span><br><span class="line">    add_time = models.DateTimeField(default=datetime.now, verbose_name=<span class="string">u"添加时间"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        verbose_name = <span class="string">u"用户课程"</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br></pre></td></tr></table></figure><p>至此：我们的五张operation下的数据表models设计完成</p><p><img src="http://myphoto.mtianyan.cn/blog/180109/BHHfi6Gj2J.png?imageslim" alt="mark"></p><h3 id="setting中配置添加app"><a href="#setting中配置添加app" class="headerlink" title="setting中配置添加app"></a>setting中配置添加app</h3><p><img src="http://myphoto.mtianyan.cn/blog/180109/9IJa5kgFAG.png?imageslim" alt="mark"></p><p>本小节对应commit:</p><blockquote><p>operation下的models设计,用户: 课程&amp;消息&amp;收藏&amp;评论&amp;我要学习.并在setting中进行了注册。对应4-8</p></blockquote><h2 id="4-9-数据表生成以及apps目录建立"><a href="#4-9-数据表生成以及apps目录建立" class="headerlink" title="4-9 数据表生成以及apps目录建立"></a>4-9 数据表生成以及apps目录建立</h2><blockquote><p>学习如何通过刚才设计的models生成数据库对应的表</p></blockquote><p>点击<code>Tools 菜单下 Run manage.py Task</code>:</p><h3 id="Python2与Python3不同"><a href="#Python2与Python3不同" class="headerlink" title="Python2与Python3不同:"></a>Python2与Python3不同:</h3><p>Python2下可能会报一些<code>noASCII</code>错误:</p><p>只需要在对应你写了中文的第一行加上:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># encoding: utf-8</span><br></pre></td></tr></table></figure><h3 id="Python3-django2-0-1-会报错"><a href="#Python3-django2-0-1-会报错" class="headerlink" title="Python3(django2.0.1)会报错:"></a>Python3(django2.0.1)会报错:</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">org = models.ForeignKey(CourseOrg, verbose_name=u&quot;所属机构&quot;)</span><br><span class="line">TypeError: __init__() missing 1 required positional argument: &apos;on_delete&apos;</span><br></pre></td></tr></table></figure><blockquote><p>这是因为在2.0.1中，外键关系必须指明删除时的操作。</p></blockquote><p>比如：出租车都归属于出租车公司。如果出租车公司倒闭了，那这些汽车该怎么处理。<br>必须自己指明: 我觉得可以直接进行级联删除。</p><p>django提供了:</p><ul><li><code>CASCADE</code></li><li><code>PROTECT</code></li><li><code>SET_NULL</code></li><li><code>SET_DEFAULT</code></li></ul><p>等选项。我选择了<code>CASCADE</code>删除。</p><p>将(dajngo 2.0.1)项目中所有的外键修改为如下面代码所示：</p><blockquote><p>也就是添加了<code>on_delete=models.CASCADE</code>使其级联删除。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org = models.ForeignKey(CourseOrg, on_delete=models.CASCADE, verbose_name=<span class="string">u"所属机构"</span>)</span><br></pre></td></tr></table></figure><h3 id="makemirgration-amp-migrate生成表"><a href="#makemirgration-amp-migrate生成表" class="headerlink" title="makemirgration &amp; migrate生成表"></a>makemirgration &amp; migrate生成表</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">makemirgration</span><br><span class="line">migrate</span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180109/mdib8gdGHc.png?imageslim" alt="mark"></p><p>上图为makemirgration过程中输出的信息。可以看到我们做出的改动</p><p><img src="http://myphoto.mtianyan.cn/blog/180109/B01J3JChmd.png?imageslim" alt="mark"></p><p>此时我们查看app目录中migrations文件夹可以看到产生的新文件。</p><p><code>operation/migrations/0001_initial.py:</code></p><blockquote><p>可以看到里面也是Python的语法。他会帮我们生成数据表。<br>以后每次<code>migrations</code>时都会生成新的initial文件。这是很重要的变动文件，不能随意删除。</p></blockquote><p>打开Navicat可以看到django的数据库中有它默认的django_migrations表</p><p><img src="http://myphoto.mtianyan.cn/blog/180109/i7Cc4HHBgh.png?imageslim" alt="mark"></p><p>双击django_migrations表可以看到我们migration的记录。</p><p><img src="http://myphoto.mtianyan.cn/blog/180109/kE5Fc9kjc7.png?imageslim" alt="mark"></p><blockquote><p>会记录哪个app下的哪个initial.py已经运行了。</p></blockquote><p>进入Navicat进行成功性验证:</p><p><img src="http://myphoto.mtianyan.cn/blog/180109/Bd16J68e9k.png?imageslim" alt="mark"></p><blockquote><p>可以看到我们的表已经生成成功,命名规则为: app名称 + 我们的类名变成小写</p></blockquote><h3 id="把我们的四个app放到一个文件夹下。"><a href="#把我们的四个app放到一个文件夹下。" class="headerlink" title="把我们的四个app放到一个文件夹下。"></a>把我们的四个app放到一个文件夹下。</h3><ul><li>新建Python的package: apps</li></ul><p><img src="http://myphoto.mtianyan.cn/blog/180109/7l4AG2maAD.png?imageslim" alt="mark"></p><ul><li>把四个app都拖进apps中去。</li></ul><p><img src="http://myphoto.mtianyan.cn/blog/180109/mGLjCiL8aj.png?imageslim" alt="mark"></p><p>去掉<code>searchfor</code>的勾选。拖进去之后会报错，说找不到那些import的模块了。</p><p>解决方案：右键<code>Mark</code>为<code>sourceRoot</code>。根目录下找不到的，会去apps下搜索。</p><p>但是这时候cmd下还是会报错。</p><p>解决方案(图来源于我的<code>DjangoGetStarted</code>教程):</p><p><img src="http://myphoto.mtianyan.cn/blog/180107/IhD2bJDI6K.png?imageslim" alt="mark"></p><p>同理,插入第0是希望它先搜索我们app下东西：</p><p><img src="http://myphoto.mtianyan.cn/blog/180109/biF9eAhLHi.png?imageslim" alt="mark"></p><h4 id="成功性验证"><a href="#成功性验证" class="headerlink" title="成功性验证"></a>成功性验证</h4><p><img src="http://myphoto.mtianyan.cn/blog/180109/hJc05K1b28.png?imageslim" alt="mark"></p><p><img src="http://myphoto.mtianyan.cn/blog/180109/BH84IH9beb.png?imageslim" alt="mark"></p><blockquote><p>可以看到Django已经可以正常run成功了。</p></blockquote><h3 id="第四章总结"><a href="#第四章总结" class="headerlink" title="第四章总结"></a>第四章总结</h3><ul><li>我们设计了app</li></ul><p><img src="http://myphoto.mtianyan.cn/blog/180109/bbbKglA0LI.png?imageslim" alt="mark"></p><ul><li>设计了user models.py</li></ul><p><img src="http://myphoto.mtianyan.cn/blog/180109/5ehi0hDB3C.png?imageslim" alt="mark"></p><ul><li>循环引用</li></ul><p><img src="http://myphoto.mtianyan.cn/blog/180109/8f32C0imcE.png?imageslim" alt="mark"></p><blockquote><p>得出我们需要创建一个更高层次的app。分层设计，operation在更高层。</p></blockquote><ul><li>Courses models.py</li></ul><p><img src="http://myphoto.mtianyan.cn/blog/180109/e60fJjHeEa.png?imageslim" alt="mark"></p><ul><li>organization models.py</li></ul><p><img src="http://myphoto.mtianyan.cn/blog/180109/jg51D6Baj7.png?imageslim" alt="mark"></p><ul><li>operation models.py</li></ul><p><img src="http://myphoto.mtianyan.cn/blog/180109/3CLeJ5LCeD.png?imageslim" alt="mark"></p><p>通过makemigrations 生成表的变动 &amp; migrate<br>每个app下的migration目录的用途，和数据库中django_migration<br>将所有app放到同一个目录之下。</p><p>本章结束对应commit:</p><blockquote><p>数据表全部生成，migration目录&amp;表django_migration。将app放到apps目录。对应4-9.<br>第四章结束！撒花。</p></blockquote></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div></div></div><div><div class="my_post_copyright"><script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script><script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script><script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script><p><span>本文标题:</span><a href="/post/56d4b4c2.html">强力Django+杀手级Xadmin打造在线教育平台(四)</a></p><p><span>文章作者:</span><a href="/" title="访问 mtianyan 的个人博客">mtianyan</a></p><p><span>发布时间:</span>2018年01月09日 - 22:01</p><p><span>最后更新:</span>2018年01月17日 - 00:01</p><p><span>原始链接:</span><a href="/post/56d4b4c2.html" title="强力Django+杀手级Xadmin打造在线教育平台(四)">http://blog.mtianyan.cn/post/56d4b4c2.html</a><span class="copy-path" title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="http://blog.mtianyan.cn/post/56d4b4c2.html" aria-label="复制成功！"></i></span></p><p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p></div><script>var clipboard=new Clipboard(".fa-clipboard");$(".fa-clipboard").click(function(){clipboard.on("success",function(){swal({title:"",text:"复制成功",icon:"success",showConfirmButton:!0})})})</script></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>请博主吃包辣条</div> <button id="rewardButton" disable="enable" onclick='var qr=document.getElementById("QR");"none"===qr.style.display?qr.style.display="block":qr.style.display="none"'> <span>打赏</span></button><div id="QR" style="display:none"><div id="wechat" style="display:inline-block"> <img id="wechat_qr" src="/images/wechatpay.png" alt="mtianyan 微信支付"><p>微信支付</p></div><div id="alipay" style="display:inline-block"> <img id="alipay_qr" src="/images/alipay.jpg" alt="mtianyan 支付宝"><p>支付宝</p></div></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Python/" rel="tag"><i class="fa fa-tag"></i> Python</a><a href="/tags/Django/" rel="tag"><i class="fa fa-tag"></i> Django</a><a href="/tags/在线教育平台/" rel="tag"><i class="fa fa-tag"></i> 在线教育平台</a></div><div class="post-widgets"><div id="needsharebutton-postbottom"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/post/ac975bcd.html" rel="next" title="强力Django+杀手级Xadmin打造在线教育平台(三)"><i class="fa fa-chevron-left"></i> 强力Django+杀手级Xadmin打造在线教育平台(三)</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/post/507fe3bf.html" rel="prev" title="强力Django+杀手级Xadmin打造在线教育平台(五)">强力Django+杀手级Xadmin打造在线教育平台(五)<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"><div class="jiathis_style"> <span class="jiathis_txt">分享到：</span> <a class="jiathis_button_fav">收藏夹</a> <a class="jiathis_button_copy">复制网址</a> <a class="jiathis_button_email">邮件</a> <a class="jiathis_button_weixin">微信</a> <a class="jiathis_button_qzone">QQ空间</a> <a class="jiathis_button_tqq">腾讯微博</a> <a class="jiathis_button_douban">豆瓣</a> <a class="jiathis_button_share">一键分享</a> <a href="http://www.jiathis.com/share?uid=2140465" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a><a class="jiathis_counter_style"></a></div><script type="text/javascript">var jiathis_config={data_track_clickback:!0,summary:"",shortUrl:!1,hideMore:!1}</script><script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=2154292" charset="utf-8"></script></div></div></div><div class="comments" id="comments"><div id="SOHUCS"></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> 站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="mtianyan"><p class="site-author-name" itemprop="name">mtianyan</p><p class="site-description motion-element" itemprop="description">爱分享，爱技术，爱生活。</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">34</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">5</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">22</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/mtianyan" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="https://www.jianshu.com/u/db9a7a0daa1f" target="_blank" title="简书"><i class="fa fa-fw fa-book"></i> 简书</a></span><span class="links-of-author-item"><a href="https://plus.google.com/u/0/114963812195952881148" target="_blank" title="Google"><i class="fa fa-fw fa-google"></i> Google</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> 友情链接</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="http://mtianyan.gitee.io/" title="本站孪生站(国内码云托管)" target="_blank">本站孪生站(国内码云托管)</a></li></ul></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-使用py3-6和django1-11开发系统前注意事项"><span class="nav-number">1.</span> <span class="nav-text">4-1 使用py3.6和django1.11开发系统前注意事项</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#虚拟环境问题"><span class="nav-number">1.1.</span> <span class="nav-text">虚拟环境问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#设计model的时候的-unicode-方法"><span class="nav-number">1.2.</span> <span class="nav-text">设计model的时候的__unicode__方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装Python的mysql驱动时不能用之前的-MYSQL-python"><span class="nav-number">1.3.</span> <span class="nav-text">安装Python的mysql驱动时不能用之前的 MYSQL python</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#通过源码方式安装xadmin时。"><span class="nav-number">1.4.</span> <span class="nav-text">通过源码方式安装xadmin时。</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用DjangoUeditor"><span class="nav-number">1.5.</span> <span class="nav-text">使用DjangoUeditor</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-django-app-设计"><span class="nav-number">2.</span> <span class="nav-text">4-2 django-app 设计</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#根据app设计-models"><span class="nav-number">2.1.</span> <span class="nav-text">根据app设计 models</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据表生成与修改"><span class="nav-number">2.2.</span> <span class="nav-text">数据表生成与修改</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3-新建项目"><span class="nav-number">3.</span> <span class="nav-text">4-3 新建项目</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Python2-7-创建虚拟环境。"><span class="nav-number">3.1.</span> <span class="nav-text">Python2.7 创建虚拟环境。</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Python3-x-创建虚拟环境"><span class="nav-number">3.2.</span> <span class="nav-text">Python3.x 创建虚拟环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#新建Python2-下Project"><span class="nav-number">3.3.</span> <span class="nav-text">新建Python2 下Project</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#安装mysql驱动。"><span class="nav-number">3.3.1.</span> <span class="nav-text">安装mysql驱动。</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#新建Python3-下Project"><span class="nav-number">3.4.</span> <span class="nav-text">新建Python3 下Project</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#安装mysql驱动。-1"><span class="nav-number">3.4.1.</span> <span class="nav-text">安装mysql驱动。</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#setting中配置"><span class="nav-number">3.5.</span> <span class="nav-text">setting中配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#前往Navicat新建数据库"><span class="nav-number">3.6.</span> <span class="nav-text">前往Navicat新建数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#进行数据库初始化makemigrations"><span class="nav-number">3.6.1.</span> <span class="nav-text">进行数据库初始化makemigrations</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-4-自定义userprofile"><span class="nav-number">4.</span> <span class="nav-text">4-4 自定义userprofile</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#编写我们的model设计user表。"><span class="nav-number">4.1.</span> <span class="nav-text">编写我们的model设计user表。</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#setting设置INSTALLED-APPS-amp-AUTH-USER-MODEL。"><span class="nav-number">4.1.1.</span> <span class="nav-text">setting设置INSTALLED_APPS &amp; AUTH_USER_MODEL。</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进入Navicat进行验证"><span class="nav-number">4.2.</span> <span class="nav-text">进入Navicat进行验证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#附加Python3下不同与报错："><span class="nav-number">4.3.</span> <span class="nav-text">附加Python3下不同与报错：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-5-user-modesl-py设计"><span class="nav-number">5.</span> <span class="nav-text">4-5 user modesl.py设计</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#解决循环引用-分层设计"><span class="nav-number">5.1.</span> <span class="nav-text">解决循环引用: 分层设计</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-6-course-models-py编写"><span class="nav-number">6.</span> <span class="nav-text">4-6 course models.py编写</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-7-organization-modesl-py设计"><span class="nav-number">7.</span> <span class="nav-text">4-7 organization modesl.py设计</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-8-operation-models-py设计"><span class="nav-number">8.</span> <span class="nav-text">4-8 operation models.py设计</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#setting中配置添加app"><span class="nav-number">8.1.</span> <span class="nav-text">setting中配置添加app</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-9-数据表生成以及apps目录建立"><span class="nav-number">9.</span> <span class="nav-text">4-9 数据表生成以及apps目录建立</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Python2与Python3不同"><span class="nav-number">9.1.</span> <span class="nav-text">Python2与Python3不同:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Python3-django2-0-1-会报错"><span class="nav-number">9.2.</span> <span class="nav-text">Python3(django2.0.1)会报错:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#makemirgration-amp-migrate生成表"><span class="nav-number">9.3.</span> <span class="nav-text">makemirgration &amp; migrate生成表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#把我们的四个app放到一个文件夹下。"><span class="nav-number">9.4.</span> <span class="nav-text">把我们的四个app放到一个文件夹下。</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#成功性验证"><span class="nav-number">9.4.1.</span> <span class="nav-text">成功性验证</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#第四章总结"><span class="nav-number">9.5.</span> <span class="nav-text">第四章总结</span></a></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright">&copy; 2015 &mdash; <span itemprop="copyrightYear">2018</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">mtianyan</span><div class="theme-info"><div class="powered-by"></div> <span class="post-count">博客全站共178.0k字</span></div></div><div class="busuanzi-count"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script> <span class="site-uv">本站访客数<span class="busuanzi-value" id="busuanzi_value_site_uv"></span> 人次</span> <span class="site-pv">本站总访问量<span class="busuanzi-value" id="busuanzi_value_site_pv"></span> 次</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script><script type="text/javascript">!function(){var t="1eb79150519fd9b791c77e8eef6f3632";if((window.innerWidth||document.documentElement.clientWidth)<960)window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=cyrJmJ3rL&conf='+t+'"><\/script>');else{!function(t,e){var n=document.getElementsByTagName("head")[0]||document.head||document.documentElement,a=document.createElement("script");a.setAttribute("type","text/javascript"),a.setAttribute("charset","UTF-8"),a.setAttribute("src",t),"function"==typeof e&&(window.attachEvent?a.onreadystatechange=function(){var t=a.readyState;"loaded"!==t&&"complete"!==t||(a.onreadystatechange=null,e())}:a.onload=e),n.appendChild(a)}("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:"cyrJmJ3rL",conf:t})})}}()</script><script type="text/javascript" src="https://assets.changyan.sohu.com/upload/plugins/plugins.count.js"></script><script type="text/javascript">var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")};function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var searchFunc=function(t,e,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,r=document.getElementById(e),s=document.getElementById(o),a=function(){var t=r.value.trim().toLowerCase(),e=t.split(/[\s\-]+/);e.length>1&&e.push(t);var o=[];if(t.length>0&&n.forEach(function(n){var r=!1,s=0,a=0,i=n.title.trim(),c=i.toLowerCase(),l=n.content.trim().replace(/<[^>]+>/g,""),h=l.toLowerCase(),p=decodeURIComponent(n.url),u=[],f=[];if(""!=i&&(e.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());(s=e.indexOf(t,r))>-1;)a.push({position:s,word:t}),r=s+n;return a}u=u.concat(e(t,c,!1)),f=f.concat(e(t,h,!1))}),(u.length>0||f.length>0)&&(r=!0,s=u.length+f.length)),r){[u,f].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});function d(e,o,n,r){for(var s=r[r.length-1],i=s.position,c=s.word,l=[],h=0;i+c.length<=n&&0!=r.length;){c===t&&h++,l.push({position:i,length:c.length});var p=i+c.length;for(r.pop();0!=r.length&&(i=(s=r[r.length-1]).position,c=s.word,p>i);)r.pop()}return a+=h,{hits:l,start:o,end:n,searchTextCount:h}}var g=[];0!=u.length&&g.push(d(0,0,i.length,u));for(var v=[];0!=f.length;){var $=f[f.length-1],C=$.position,m=$.word,x=C-20,w=C+80;x<0&&(x=0),w<C+m.length&&(w=C+m.length),w>l.length&&(w=l.length),v.push(d(0,x,w,f))}v.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var y=parseInt("1");y>=0&&(v=v.slice(0,y));function T(t,e){var o="",n=e.start;return e.hits.forEach(function(e){o+=t.substring(n,e.position);var r=e.position+e.length;o+='<b class="search-keyword">'+t.substring(e.position,r)+"</b>",n=r}),o+=t.substring(n,e.end)}var b="";0!=g.length?b+="<li><a href='"+p+"' class='search-result-title'>"+T(i,g[0])+"</a>":b+="<li><a href='"+p+"' class='search-result-title'>"+i+"</a>",v.forEach(function(t){b+="<a href='"+p+'\'><p class="search-result">'+T(l,t)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:a,hitCount:s,id:o.length})}}),1===e.length&&""===e[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{o.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var a='<ul class="search-result-list">';o.forEach(function(t){a+=t.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),!1===isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){27===t.which&&$(".search-popup").is(":visible")&&onPopupClose()})</script><script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script><script>AV.initialize("2uqmIjYredIvFy6tEXbKG4Fj-gzGzoHsz","CWl1rE8cQlIseOg2Cq3hzxYi")</script><script>function showTime(e){var t=new AV.Query(e),n=[],o=$(".leancloud_visitors");o.each(function(){n.push($(this).attr("id").trim())}),t.containedIn("url",n),t.find().done(function(e){var t=".leancloud-visitors-count";if(0!==e.length){for(var i=0;i<e.length;i++){var s=e[i],r=s.get("url"),l=s.get("time"),c=document.getElementById(r);$(c).find(t).text(l)}for(i=0;i<n.length;i++){r=n[i],c=document.getElementById(r);var u=$(c).find(t);""==u.text()&&u.text(0)}}else o.find(t).text(0)}).fail(function(e,t){console.log("Error: "+t.code+" "+t.message)})}function addCount(e){var t=$(".leancloud_visitors"),n=t.attr("id").trim(),o=t.attr("data-flag-title").trim(),i=new AV.Query(e);i.equalTo("url",n),i.find({success:function(t){if(t.length>0){var i=t[0];i.fetchWhenSave(!0),i.increment("time"),i.save(null,{success:function(e){$(document.getElementById(n)).find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})}else{var s=new e,r=new AV.ACL;r.setPublicReadAccess(!0),r.setPublicWriteAccess(!0),s.setACL(r),s.set("title",o),s.set("url",n),s.set("time",1),s.save(null,{success:function(e){$(document.getElementById(n)).find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to create")}})}},error:function(e){console.log("Error:"+e.code+" "+e.message)}})}$(function(){var e=AV.Object.extend("Counter");1==$(".leancloud_visitors").length?addCount(e):$(".post-title-link").length>1&&showTime(e)})</script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={},pbOptions.iconStyle="default",pbOptions.boxForm="horizontal",pbOptions.position="bottomCenter",pbOptions.networks="Weibo,Wechat,Douban,QQZone,Twitter,Facebook",new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={},flOptions.iconStyle="default",flOptions.boxForm="horizontal",flOptions.position="middleRight",flOptions.networks="Weibo,Wechat,Douban,QQZone,Twitter,Facebook",new needShareButton("#needsharebutton-float",flOptions)</script><script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script><script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script><script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script><div id="hexo-helper-live2d"><canvas id="live2dcanvas" width="150" height="300"></canvas></div><style>#live2dcanvas{position:fixed;width:150px;height:300px;opacity:.7;right:-30px;z-index:999;pointer-events:none;bottom:40px}</style><script type="text/javascript" src="/live2d/device.min.js"></script><script type="text/javascript">
const loadScript = function loadScript(c,b){var a=document.createElement("script");a.type="text/javascript";"undefined"!=typeof b&&(a.readyState?a.onreadystatechange=function(){if("loaded"==a.readyState||"complete"==a.readyState)a.onreadystatechange=null,b()}:a.onload=function(){b()});a.src=c;document.body.appendChild(a)};
(function(){
  if((typeof(device) != 'undefined') && (device.mobile())){
    var trElement = document.getElementById('hexo-helper-live2d');
    trElement.parentNode.removeChild(trElement);
    return;
  }else
    if (typeof(device) === 'undefined') console.error('Cannot find current-device script.');
  loadScript("/live2d/script.js", function(){loadlive2d("live2dcanvas", "/live2d/assets/hijiki.model.json", 0.5);});
})();
</script></body></html><script type="text/javascript" src="/js/src/love.js"></script>