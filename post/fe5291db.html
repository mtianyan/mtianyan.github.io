<!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><script></script><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3"><link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222"><meta name="keywords" content="Python,Django,在线教育平台,"><link rel="alternate" href="/atom.xml" title="mtianyan's blog" type="application/atom+xml"><meta name="description" content="不以个人为中心, 但我们得有个个人中心。   做一做全局导航，做一做个人中心，做一做全局搜索。洒洒水啦。"><meta name="keywords" content="Python,Django,在线教育平台"><meta property="og:type" content="article"><meta property="og:title" content="强力Django+杀手级Xadmin打造在线教育平台(十)"><meta property="og:url" content="http://blog.mtianyan.cn/post/fe5291db.html"><meta property="og:site_name" content="mtianyan&#39;s blog"><meta property="og:description" content="不以个人为中心, 但我们得有个个人中心。   做一做全局导航，做一做个人中心，做一做全局搜索。洒洒水啦。"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180114/4LGd72eA4J.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180114/kGG5I71CE1.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180114/3I2G5kaK1G.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180114/Jabljb878I.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180114/Lb09b3457I.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180114/1IGKhbagJC.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180114/he98j111Lj.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180114/J6kBci76lA.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180114/3Bm665idcK.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180114/CC02dfbG57.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180114/ADFBmE7a6B.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180114/8LAe6f1dl7.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180114/i92c3ffgJD.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180114/LjGjh0B3cL.png?imageslim"><meta property="og:image" content="http://myphoto.mtianyan.cn/blog/180114/B4HKiBfla1.png?imageslim"><meta property="og:updated_time" content="2018-01-16T16:33:05.291Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="强力Django+杀手级Xadmin打造在线教育平台(十)"><meta name="twitter:description" content="不以个人为中心, 但我们得有个个人中心。   做一做全局导航，做一做个人中心，做一做全局搜索。洒洒水啦。"><meta name="twitter:image" content="http://myphoto.mtianyan.cn/blog/180114/4LGd72eA4J.png?imageslim"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"5.1.3",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!0,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://blog.mtianyan.cn/post/fe5291db.html"><script>!function(e,t,o,c,i,a,n){e.DaoVoiceObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,a=t.createElement("script"),n=t.getElementsByTagName("script")[0],a.async=1,a.src=c,a.charset="utf-8",n.parentNode.insertBefore(a,n)}(window,document,0,("https:"==document.location.protocol?"https:":"http:")+"//widget.daovoice.io/widget/0f81ff2f.js","daovoice"),daovoice("init",{app_id:"e28768be"}),daovoice("update")</script><title>强力Django+杀手级Xadmin打造在线教育平台(十) | mtianyan's blog</title><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?415372bd35fec36f7558dd96b48ec03f";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div> <a href="https://github.com/mtianyan" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">mtianyan's blog</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">天涯明月笙的博客小站(Github托管)</p></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> 归档</a></li><li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="menu-item-icon fa fa-fw fa-heartbeat"></i><br> 公益404</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br> 搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"> <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://blog.mtianyan.cn/post/fe5291db.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="mtianyan"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="mtianyan's blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">强力Django+杀手级Xadmin打造在线教育平台(十)</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-15T22:09:17+08:00">2018-01-15</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Django-Xadmin打造在线教育平台/" itemprop="url" rel="index"><span itemprop="name">Django+Xadmin打造在线教育平台</span></a></span></span> <span id="/post/fe5291db.html" class="leancloud_visitors" data-flag-title="强力Django+杀手级Xadmin打造在线教育平台(十)"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">热度&#58;</span><span class="leancloud-visitors-count"></span> <span>℃</span></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">2,312</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">11</span></div></div></header><div class="post-body" itemprop="articleBody"><blockquote class="blockquote-center"><p>不以个人为中心, 但我们得有个个人中心。</p></blockquote><div class="note default"><p>做一做全局导航，做一做个人中心，做一做全局搜索。<br>洒洒水啦。</p></div><a id="more"></a><h2 id="配置全局导航"><a href="#配置全局导航" class="headerlink" title="配置全局导航"></a>配置全局导航</h2><p>让index页面也继承base页面</p><p>base页面的导航栏配置</p><p><img src="http://myphoto.mtianyan.cn/blog/180114/4LGd72eA4J.png?imageslim" alt="mark"></p><p>但是现在我们不知道当前是哪一个页面，因为后端没有传值过来</p><p>后台的每个view中添加current nav字段。然后向上传递到base页面</p><p>为了满足前台有current view的值，我们写的每个view都得加上这个字段。</p><p>小技巧：根据request的地址中的前几位来判断在哪一个区域之下</p><p>request.path</p><p>修改url中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 访问机构讲师</span><br><span class="line">url(r&apos;^org_teacher/(?P&lt;org_id&gt;\d+)/$&apos;, OrgTeacherView.as_view(), name=&quot;org_teacher&quot;),</span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180114/kGG5I71CE1.png?imageslim" alt="mark"></p><h2 id="全局搜索功能开发"><a href="#全局搜索功能开发" class="headerlink" title="全局搜索功能开发"></a>全局搜索功能开发</h2><p>搜索跳到列表展示</p><p>courselist后加参数keywords</p><p>搜索的代码放在deco-common js中</p><p>课程的搜索功能：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 搜索功能</span><br><span class="line">search_keywords = request.GET.get(&apos;keywords&apos;,&apos;&apos;)</span><br><span class="line">if search_keywords:</span><br><span class="line">    # 在name字段进行操作,做like语句的操作。i代表不区分大小写</span><br><span class="line">    # or操作使用Q</span><br><span class="line">    all_course = all_course.filter(Q(name__icontains=search_keywords)|Q(desc__icontains=search_keywords)|Q(detail__icontains=search_keywords))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;search_keywords&quot;:search_keywords,</span><br></pre></td></tr></table></figure><h2 id="个人中心信息展示"><a href="#个人中心信息展示" class="headerlink" title="个人中心信息展示"></a>个人中心信息展示</h2><p>将用户中心相关的六个页面，全部拷贝进template</p><p>新建usercenter base页面</p><p><img src="http://myphoto.mtianyan.cn/blog/180114/3I2G5kaK1G.png?imageslim" alt="mark"></p><p>配置url</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># user app的url配置</span><br><span class="line">url(r&quot;^users/&quot;, include(&apos;users.urls&apos;, namespace=&quot;users&quot;)),</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># encoding: utf-8</span><br><span class="line">from .views import UserInfoView</span><br><span class="line"></span><br><span class="line">__author__ = &apos;mtianyan&apos;</span><br><span class="line">__date__ = &apos;2018/1/14 0014 04:00&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">from django.conf.urls import url</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    # 用户信息</span><br><span class="line">    url(r&apos;^info/$&apos;, UserInfoView.as_view(), name=&quot;user_info&quot;),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 用户个人信息view</span><br><span class="line">class UserInfoView(LoginRequiredMixin,View):</span><br><span class="line">    login_url = &apos;/login/&apos;</span><br><span class="line">    redirect_field_name = &apos;next&apos;</span><br><span class="line">    def get(self, request):</span><br><span class="line">        return render(request, &quot;usercenter-info.html&quot;, &#123;</span><br><span class="line"></span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure><p>user app 下新建url</p><p>django自带的filter</p><p>request.user.mobile|default_if_none:’’</p><h2 id="修改密码和修改头像"><a href="#修改密码和修改头像" class="headerlink" title="修改密码和修改头像"></a>修改密码和修改头像</h2><p>新建url 和 view</p><p>小技巧:</p><blockquote><p>django的xadmin和admin当中，实际上是可以对form定义为文件的时候，是可以自动对上传的文件做保存的。<br>使用form的一个字段定义一个文件类型。把字段取出来就是内存中的文件。<br>赋值到user.image 就完成图片的一个存储。</p></blockquote><p>users/forms.py：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 用于文件上传，修改头像</span><br><span class="line">class UploadImageForm(forms.ModelForm):</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        model = UserProfile</span><br><span class="line">        fields = [&apos;image&apos;]</span><br></pre></td></tr></table></figure><p>实例化时，传进来是post 和 文件类型的request 存放地址</p><p><img src="http://myphoto.mtianyan.cn/blog/180114/Jabljb878I.png?imageslim" alt="mark"></p><p><img src="http://myphoto.mtianyan.cn/blog/180114/Lb09b3457I.png?imageslim" alt="mark"></p><p>上传文件时通过一个form完成的。</p><p><img src="http://myphoto.mtianyan.cn/blog/180114/1IGKhbagJC.png?imageslim" alt="mark"></p><p>必须指明enctype，才能把文件类型传递到后台</p><p>url 和view</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 用户头像上传</span><br><span class="line">url(r&apos;^image/upload/$&apos;, UploadImageView.as_view(), name=&quot;image_upload&quot;),</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 用户上传图片的view:用于修改头像</span><br><span class="line">class UploadImageView(LoginRequiredMixin, View):</span><br><span class="line">    login_url = &apos;/login/&apos;</span><br><span class="line">    redirect_field_name = &apos;next&apos;</span><br><span class="line">    def post(self, request):</span><br><span class="line">        # 这时候用户上传的文件就已经被保存到imageform了</span><br><span class="line">        image_form = UploadImageForm(request.POST, request.FILES)</span><br><span class="line">        if image_form.is_valid():</span><br><span class="line">            pass</span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180114/he98j111Lj.png?imageslim" alt="mark"></p><p>这里的name必须和form中的一样</p><p><img src="http://myphoto.mtianyan.cn/blog/180114/J6kBci76lA.png?imageslim" alt="mark"></p><p><img src="http://myphoto.mtianyan.cn/blog/180114/3Bm665idcK.png?imageslim" alt="mark"></p><blockquote><p>所有验证通过的字段放在cleaned data</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 用户上传图片的view:用于修改头像</span><br><span class="line">class UploadImageView(LoginRequiredMixin, View):</span><br><span class="line">    login_url = &apos;/login/&apos;</span><br><span class="line">    redirect_field_name = &apos;next&apos;</span><br><span class="line">    def post(self, request):</span><br><span class="line">        # 这时候用户上传的文件就已经被保存到imageform了 ，为modelform添加instance值直接保存</span><br><span class="line">        image_form = UploadImageForm(request.POST, request.FILES, instance=request.user)</span><br><span class="line">        if image_form.is_valid():</span><br><span class="line">            image_form.save()</span><br><span class="line">            # # 取出cleaned data中的值,一个dict</span><br><span class="line">            # image = image_form.cleaned_data[&apos;image&apos;]</span><br><span class="line">            # request.user.image = image</span><br><span class="line">            # request.user.save()</span><br><span class="line">            return HttpResponse(&apos;&#123;&quot;status&quot;:&quot;success&quot;&#125;&apos;, content_type=&apos;application/json&apos;)</span><br><span class="line">        else:</span><br><span class="line">            return HttpResponse(&apos;&#123;&quot;status&quot;:&quot;fail&quot;&#125;&apos;, content_type=&apos;application/json&apos;)</span><br></pre></td></tr></table></figure><p>修改密码功能:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 在个人中心修改用户密码</span><br><span class="line">class UpdatePwdView(View):</span><br><span class="line">    def post(self, request):</span><br><span class="line">        modiypwd_form = ModifyPwdForm(request.POST)</span><br><span class="line">        if modiypwd_form.is_valid():</span><br><span class="line">            pwd1 = request.POST.get(&quot;password1&quot;, &quot;&quot;)</span><br><span class="line">            pwd2 = request.POST.get(&quot;password2&quot;, &quot;&quot;)</span><br><span class="line">            # 如果两次密码不相等，返回错误信息</span><br><span class="line">            if pwd1 != pwd2:</span><br><span class="line">                return HttpResponse(&apos;&#123;&quot;status&quot;:&quot;fail&quot;, &quot;msg&quot;:&quot;密码不一致&quot;&#125;&apos;, content_type=&apos;application/json&apos;)</span><br><span class="line">            # 如果密码一致</span><br><span class="line">            user =request.user</span><br><span class="line">            # 加密成密文</span><br><span class="line">            user.password = make_password(pwd2)</span><br><span class="line">            # save保存到数据库</span><br><span class="line">            user.save()</span><br><span class="line">            return HttpResponse(&apos;&#123;&quot;status&quot;:&quot;success&quot;&#125;&apos;, content_type=&apos;application/json&apos;)</span><br><span class="line">        # 验证失败说明密码位数不够。</span><br><span class="line">        else:</span><br><span class="line">            return HttpResponse(&apos;&#123;&quot;status&quot;:&quot;fail&quot;, &quot;msg&quot;:&quot;填写错误请检查&quot;&#125;&apos;, content_type=&apos;application/json&apos;)</span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180114/CC02dfbG57.png?imageslim" alt="mark"></p><p>必须与我们的form中定义的一致</p><p>实现的js代码在deco-user.js</p><p>js文件中的url就一定不能用template的模板语言了</p><h2 id="修改邮箱提交form表单"><a href="#修改邮箱提交form表单" class="headerlink" title="修改邮箱提交form表单"></a>修改邮箱提交form表单</h2><p>有两个接口需要完成。点击获取验证码时，后台需要向用户新邮箱发送验证码。<br>邮箱如果出错，会返回错误信息。</p><p>输入了邮箱和验证码，验证是否匹配。</p><h3 id="获取验证码接口"><a href="#获取验证码接口" class="headerlink" title="获取验证码接口:"></a>获取验证码接口:</h3><p>配置url:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 专用于发送验证码的</span><br><span class="line">url(r&apos;^sendemail_code/$&apos;, SendEmailCodeView.as_view(), name=&quot;sendemail_code&quot;),</span><br></pre></td></tr></table></figure><p>新增邮箱验证码model类型</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SEND_CHOICES = (</span><br><span class="line">        (&quot;register&quot;, u&quot;注册&quot;),</span><br><span class="line">        (&quot;forget&quot;, u&quot;找回密码&quot;),</span><br><span class="line">        (&quot;update_email&quot;, u&quot;修改邮箱&quot;)</span><br><span class="line">    )</span><br><span class="line">           max_length=20,</span><br></pre></td></tr></table></figure><p>发送邮箱验证码view</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">class SendEmailCodeView(LoginRequiredMixin, View):</span><br><span class="line">    def get(self,request):</span><br><span class="line">        # 取出需要发送的邮件</span><br><span class="line">        email = request.GET.get(&quot;email&quot;, &quot;&quot;)</span><br><span class="line"></span><br><span class="line">        # 不能是已注册的邮箱</span><br><span class="line">        if UserProfile.objects.filter(email=email):</span><br><span class="line">            return HttpResponse(&apos;&#123;&quot;email&quot;:&quot;邮箱已经存在&quot;&#125;&apos;, content_type=&apos;application/json&apos;)</span><br><span class="line">        send_register_eamil(email, &quot;update_email&quot;)</span><br><span class="line">        return HttpResponse(&apos;&#123;&quot;status&quot;:&quot;success&quot;&#125;&apos;, content_type=&apos;application/json&apos;)</span><br></pre></td></tr></table></figure><p>发送邮箱验证码的功能放在deco-user.js中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">elif send_type == &quot;update_email&quot;:</span><br><span class="line">    code = random_str(4)</span><br><span class="line">    email_title = &quot;mtianyan慕课小站 修改邮箱验证码&quot;</span><br><span class="line">    email_body = loader.render_to_string(</span><br><span class="line">        &quot;email_update_email.html&quot;,  # 需要渲染的html模板</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;active_code&quot;: code  # 参数</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">    msg = EmailMessage(email_title, email_body, EMAIL_FROM, [email])</span><br><span class="line">    msg.content_subtype = &quot;html&quot;</span><br><span class="line">    send_status = msg.send()</span><br></pre></td></tr></table></figure><h3 id="修改邮箱的view"><a href="#修改邮箱的view" class="headerlink" title="修改邮箱的view"></a>修改邮箱的view</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 修改邮箱的view:</span><br><span class="line">class UpdateEmailView(LoginRequiredMixin, View):</span><br><span class="line">    login_url = &apos;/login/&apos;</span><br><span class="line">    redirect_field_name = &apos;next&apos;</span><br><span class="line">    def post(self, request):</span><br><span class="line">        email = request.POST.get(&quot;email&quot;, &quot;&quot;)</span><br><span class="line">        code = request.POST.get(&quot;code&quot;, &quot;&quot;)</span><br><span class="line"></span><br><span class="line">        existed_records = EmailVerifyRecord.objects.filter(email=email, code=code, send_type=&apos;update_email&apos;)</span><br><span class="line">        if existed_records:</span><br><span class="line">            user = request.user</span><br><span class="line">            user.email = email</span><br><span class="line">            user.save()</span><br><span class="line">            return HttpResponse(&apos;&#123;&quot;status&quot;:&quot;success&quot;&#125;&apos;, content_type=&apos;application/json&apos;)</span><br><span class="line">        else:</span><br><span class="line">            return HttpResponse(&apos;&#123;&quot;email&quot;:&quot;验证码无效&quot;&#125;&apos;, content_type=&apos;application/json&apos;)</span><br></pre></td></tr></table></figure><p>修改邮箱的url</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(r&apos;^update_email/$&apos;, UpdateEmailView.as_view(), name=&quot;update_email&quot;),</span><br></pre></td></tr></table></figure><p>为userInfo view增加post方法。使用modelform完成直接提交</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def post(self,request):</span><br><span class="line">    # 不像用户咨询是一个新的。需要指明instance。不然无法修改，而是新增用户</span><br><span class="line">    user_info_form = UserInfoForm(request.POST, instance=request.user)</span><br><span class="line">    if user_info_form.is_valid():</span><br><span class="line">        user_info_form.save()</span><br></pre></td></tr></table></figure><p>user_info_form</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 用于个人中心修改个人信息</span><br><span class="line">class UserInfoForm(forms.ModelForm):</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        model = UserProfile</span><br><span class="line">        fields = [&apos;nick_name&apos;,&apos;gender&apos;,&apos;birthday&apos;,&apos;address&apos;,&apos;mobile&apos;]</span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180114/ADFBmE7a6B.png?imageslim" alt="mark"></p><p>配置url和view</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 用户中心我的课程</span><br><span class="line">path(&apos;mycourse/&apos;, MyCourseView.as_view(), name=&quot;mycourse&quot;),</span><br></pre></td></tr></table></figure><p>usercenter base中添加链接</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 个人中心页我的课程</span><br><span class="line"></span><br><span class="line">class MyCourseView(LoginRequiredMixin, View):</span><br><span class="line">    login_url = &apos;/login/&apos;</span><br><span class="line">    redirect_field_name = &apos;next&apos;</span><br><span class="line"></span><br><span class="line">    def get(self, request):</span><br><span class="line">        user_courses = UserCourse.objects.filter(user=request.user)</span><br><span class="line">        return render(request, &quot;usercenter-mycourse.html&quot;, &#123;</span><br><span class="line">            &quot;user_courses&quot;:user_courses,</span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure><p><img src="http://myphoto.mtianyan.cn/blog/180114/8LAe6f1dl7.png?imageslim" alt="mark"></p><h3 id="配置url和view"><a href="#配置url和view" class="headerlink" title="配置url和view"></a>配置url和view</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 我收藏的课程机构</span><br><span class="line">path(&apos;myfav/org/&apos;, MyFavOrgView.as_view(), name=&quot;myfav_org&quot;),</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">class MyFavOrgView(LoginRequiredMixin, View):</span><br><span class="line">    login_url = &apos;/login/&apos;</span><br><span class="line">    redirect_field_name = &apos;next&apos;</span><br><span class="line"></span><br><span class="line">    def get(self, request):</span><br><span class="line">        org_list = []</span><br><span class="line">        fav_orgs= UserFavorite.objects.filter(user=request.user, fav_type=2)</span><br><span class="line">        # 上面的fav_orgs只是存放了id。我们还需要通过id找到机构对象</span><br><span class="line">        for fav_org in fav_orgs:</span><br><span class="line">            # 取出fav_id也就是机构的id。</span><br><span class="line">            org_id = fav_org.fav_id</span><br><span class="line">            # 获取这个机构对象</span><br><span class="line">            org = CourseOrg.objects.get(id=org_id)</span><br><span class="line">            org_list.append(org)</span><br><span class="line">        return render(request, &quot;usercenter-fav-org.html&quot;, &#123;</span><br><span class="line">            &quot;org_list&quot;: org_list,</span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 我收藏的授课讲师</span><br><span class="line"></span><br><span class="line">class MyFavTeacherView(LoginRequiredMixin, View):</span><br><span class="line">    login_url = &apos;/login/&apos;</span><br><span class="line">    redirect_field_name = &apos;next&apos;</span><br><span class="line"></span><br><span class="line">    def get(self, request):</span><br><span class="line">        teacher_list = []</span><br><span class="line">        fav_teachers= UserFavorite.objects.filter(user=request.user, fav_type=3)</span><br><span class="line">        # 上面的fav_orgs只是存放了id。我们还需要通过id找到机构对象</span><br><span class="line">        for fav_teacher in fav_teachers:</span><br><span class="line">            # 取出fav_id也就是机构的id。</span><br><span class="line">            teacher_id = fav_teacher.fav_id</span><br><span class="line">            # 获取这个机构对象</span><br><span class="line">            teacher = Teacher.objects.get(id=teacher_id)</span><br><span class="line">            teacher_list.append(teacher)</span><br><span class="line">        return render(request, &quot;usercenter-fav-teacher.html&quot;, &#123;</span><br><span class="line">            &quot;teacher_list&quot;: teacher_list,</span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure><p>url</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 我收藏的课程机构</span><br><span class="line">path(&apos;myfav/org/&apos;, MyFavOrgView.as_view(), name=&quot;myfav_org&quot;),</span><br><span class="line"></span><br><span class="line"># 我收藏的授课讲师</span><br><span class="line">path(&apos;myfav/teacher/&apos;, MyFavTeacherView.as_view(), name=&quot;myfav_teacher&quot;),</span><br></pre></td></tr></table></figure><h3 id="配置view和url"><a href="#配置view和url" class="headerlink" title="配置view和url"></a>配置view和url</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 我收藏的课程</span><br><span class="line"></span><br><span class="line">class MyFavCourseView(LoginRequiredMixin, View):</span><br><span class="line">    login_url = &apos;/login/&apos;</span><br><span class="line">    redirect_field_name = &apos;next&apos;</span><br><span class="line"></span><br><span class="line">    def get(self, request):</span><br><span class="line">        course_list = []</span><br><span class="line">        fav_courses = UserFavorite.objects.filter(user=request.user, fav_type=1)</span><br><span class="line">        # 上面的fav_orgs只是存放了id。我们还需要通过id找到机构对象</span><br><span class="line">        for fav_course in fav_courses:</span><br><span class="line">            # 取出fav_id也就是机构的id。</span><br><span class="line">            course_id = fav_course.fav_id</span><br><span class="line">            # 获取这个机构对象</span><br><span class="line">            course = Course.objects.get(id=course_id)</span><br><span class="line">            course_list.append(course)</span><br><span class="line">        return render(request, &quot;usercenter-fav-course.html&quot;, &#123;</span><br><span class="line">            &quot;course_list&quot;: course_list,</span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 我收藏的课程</span><br><span class="line">path(&apos;myfav/course/&apos;, MyFavCourseView.as_view(), name=&quot;myfav_course&quot;),</span><br></pre></td></tr></table></figure><h2 id="取消收藏"><a href="#取消收藏" class="headerlink" title="取消收藏"></a>取消收藏</h2><p>templates/usercenter-fav-course.html</p><p><img src="http://myphoto.mtianyan.cn/blog/180114/i92c3ffgJD.png?imageslim" alt="mark"></p><p><img src="http://myphoto.mtianyan.cn/blog/180114/LjGjh0B3cL.png?imageslim" alt="mark"></p><p>取消收藏的代码在base页面中。三个js。</p><h2 id="我的消息页面"><a href="#我的消息页面" class="headerlink" title="我的消息页面"></a>我的消息页面</h2><p><img src="http://myphoto.mtianyan.cn/blog/180114/B4HKiBfla1.png?imageslim" alt="mark"></p><h3 id="配置url和view-1"><a href="#配置url和view-1" class="headerlink" title="配置url和view"></a>配置url和view</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 我收藏的课程</span><br><span class="line">path(&apos;my_message/&apos;, MyMessageView.as_view(), name=&quot;my_message&quot;),</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 我的消息</span><br><span class="line">class MyMessageView(LoginRequiredMixin, View):</span><br><span class="line">    login_url = &apos;/login/&apos;</span><br><span class="line">    redirect_field_name = &apos;next&apos;</span><br><span class="line"></span><br><span class="line">    def get(self, request):</span><br><span class="line">        all_message = UserMessage.objects.filter(user= request.user.id)</span><br><span class="line">        # 对课程机构进行分页</span><br><span class="line">        # 尝试获取前台get请求传递过来的page参数</span><br><span class="line">        # 如果是不合法的配置参数默认返回第一页</span><br><span class="line">        try:</span><br><span class="line">            page = request.GET.get(&apos;page&apos;, 1)</span><br><span class="line">        except PageNotAnInteger:</span><br><span class="line">            page = 1</span><br><span class="line">        # 这里指从allorg中取五个出来，每页显示5个</span><br><span class="line">        p = Paginator(all_message, 4)</span><br><span class="line">        messages = p.page(page)</span><br><span class="line">        return  render(request, &quot;usercenter-message.html&quot;, &#123;</span><br><span class="line">        &quot;messages&quot;:messages,</span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure><h3 id="注册时发生欢迎消息"><a href="#注册时发生欢迎消息" class="headerlink" title="注册时发生欢迎消息"></a>注册时发生欢迎消息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 写入欢迎注册消息</span><br><span class="line">           user_message = UserMessage()</span><br><span class="line">           user_message.user = user_profile.id</span><br><span class="line">           user_message.message = &quot;欢迎注册mtianyan慕课小站!!&quot;</span><br><span class="line">           user_message.save()</span><br></pre></td></tr></table></figure><h3 id="页面顶部小喇叭"><a href="#页面顶部小喇叭" class="headerlink" title="页面顶部小喇叭"></a>页面顶部小喇叭</h3><p>所有页面都要读取一个共同的变量：未读消息的数量。我们需要向request中注入这个变量<br>所有页面都有request.user对象。所以我们在userprofile中自定义方法，</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 获取用户未读消息的数量</span><br><span class="line">def unread_nums(self):</span><br><span class="line">    from operation.models import UserMessage</span><br><span class="line">    return  UserMessage.objects.filter(user=self.id).count()</span><br></pre></td></tr></table></figure></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div></div></div><div><div class="my_post_copyright"><script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script><script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script><script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script><p><span>本文标题:</span><a href="/post/fe5291db.html">强力Django+杀手级Xadmin打造在线教育平台(十)</a></p><p><span>文章作者:</span><a href="/" title="访问 mtianyan 的个人博客">mtianyan</a></p><p><span>发布时间:</span>2018年01月15日 - 22:01</p><p><span>最后更新:</span>2018年01月17日 - 00:01</p><p><span>原始链接:</span><a href="/post/fe5291db.html" title="强力Django+杀手级Xadmin打造在线教育平台(十)">http://blog.mtianyan.cn/post/fe5291db.html</a><span class="copy-path" title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="http://blog.mtianyan.cn/post/fe5291db.html" aria-label="复制成功！"></i></span></p><p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p></div><script>var clipboard=new Clipboard(".fa-clipboard");$(".fa-clipboard").click(function(){clipboard.on("success",function(){swal({title:"",text:"复制成功",icon:"success",showConfirmButton:!0})})})</script></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>请博主吃包辣条</div> <button id="rewardButton" disable="enable" onclick='var qr=document.getElementById("QR");"none"===qr.style.display?qr.style.display="block":qr.style.display="none"'> <span>打赏</span></button><div id="QR" style="display:none"><div id="wechat" style="display:inline-block"> <img id="wechat_qr" src="/images/wechatpay.png" alt="mtianyan 微信支付"><p>微信支付</p></div><div id="alipay" style="display:inline-block"> <img id="alipay_qr" src="/images/alipay.jpg" alt="mtianyan 支付宝"><p>支付宝</p></div></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Python/" rel="tag"><i class="fa fa-tag"></i> Python</a><a href="/tags/Django/" rel="tag"><i class="fa fa-tag"></i> Django</a><a href="/tags/在线教育平台/" rel="tag"><i class="fa fa-tag"></i> 在线教育平台</a></div><div class="post-widgets"><div id="needsharebutton-postbottom"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/post/83fbe6af.html" rel="next" title="强力Django+杀手级Xadmin打造在线教育平台(九)"><i class="fa fa-chevron-left"></i> 强力Django+杀手级Xadmin打造在线教育平台(九)</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/post/a5f911ea.html" rel="prev" title="强力Django+杀手级Xadmin打造在线教育平台(十一)">强力Django+杀手级Xadmin打造在线教育平台(十一)<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"><div class="jiathis_style"> <span class="jiathis_txt">分享到：</span> <a class="jiathis_button_fav">收藏夹</a> <a class="jiathis_button_copy">复制网址</a> <a class="jiathis_button_email">邮件</a> <a class="jiathis_button_weixin">微信</a> <a class="jiathis_button_qzone">QQ空间</a> <a class="jiathis_button_tqq">腾讯微博</a> <a class="jiathis_button_douban">豆瓣</a> <a class="jiathis_button_share">一键分享</a> <a href="http://www.jiathis.com/share?uid=2140465" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a><a class="jiathis_counter_style"></a></div><script type="text/javascript">var jiathis_config={data_track_clickback:!0,summary:"",shortUrl:!1,hideMore:!1}</script><script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=2154292" charset="utf-8"></script></div></div></div><div class="comments" id="comments"><div id="SOHUCS"></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> 站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="mtianyan"><p class="site-author-name" itemprop="name">mtianyan</p><p class="site-description motion-element" itemprop="description">爱分享，爱技术，爱生活。</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">34</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">5</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">22</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/mtianyan" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="https://www.jianshu.com/u/db9a7a0daa1f" target="_blank" title="简书"><i class="fa fa-fw fa-book"></i> 简书</a></span><span class="links-of-author-item"><a href="https://plus.google.com/u/0/114963812195952881148" target="_blank" title="Google"><i class="fa fa-fw fa-google"></i> Google</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> 友情链接</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="http://mtianyan.gitee.io/" title="本站孪生站(国内码云托管)" target="_blank">本站孪生站(国内码云托管)</a></li></ul></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#配置全局导航"><span class="nav-number">1.</span> <span class="nav-text">配置全局导航</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#全局搜索功能开发"><span class="nav-number">2.</span> <span class="nav-text">全局搜索功能开发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#个人中心信息展示"><span class="nav-number">3.</span> <span class="nav-text">个人中心信息展示</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#修改密码和修改头像"><span class="nav-number">4.</span> <span class="nav-text">修改密码和修改头像</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#修改邮箱提交form表单"><span class="nav-number">5.</span> <span class="nav-text">修改邮箱提交form表单</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#获取验证码接口"><span class="nav-number">5.1.</span> <span class="nav-text">获取验证码接口:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#修改邮箱的view"><span class="nav-number">5.2.</span> <span class="nav-text">修改邮箱的view</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置url和view"><span class="nav-number">5.3.</span> <span class="nav-text">配置url和view</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置view和url"><span class="nav-number">5.4.</span> <span class="nav-text">配置view和url</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#取消收藏"><span class="nav-number">6.</span> <span class="nav-text">取消收藏</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#我的消息页面"><span class="nav-number">7.</span> <span class="nav-text">我的消息页面</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#配置url和view-1"><span class="nav-number">7.1.</span> <span class="nav-text">配置url和view</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#注册时发生欢迎消息"><span class="nav-number">7.2.</span> <span class="nav-text">注册时发生欢迎消息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#页面顶部小喇叭"><span class="nav-number">7.3.</span> <span class="nav-text">页面顶部小喇叭</span></a></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright">&copy; 2015 &mdash; <span itemprop="copyrightYear">2018</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">mtianyan</span><div class="theme-info"><div class="powered-by"></div> <span class="post-count">博客全站共178.0k字</span></div></div><div class="busuanzi-count"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script> <span class="site-uv">本站访客数<span class="busuanzi-value" id="busuanzi_value_site_uv"></span> 人次</span> <span class="site-pv">本站总访问量<span class="busuanzi-value" id="busuanzi_value_site_pv"></span> 次</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script><script type="text/javascript">!function(){var t="1eb79150519fd9b791c77e8eef6f3632";if((window.innerWidth||document.documentElement.clientWidth)<960)window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=cyrJmJ3rL&conf='+t+'"><\/script>');else{!function(t,e){var n=document.getElementsByTagName("head")[0]||document.head||document.documentElement,a=document.createElement("script");a.setAttribute("type","text/javascript"),a.setAttribute("charset","UTF-8"),a.setAttribute("src",t),"function"==typeof e&&(window.attachEvent?a.onreadystatechange=function(){var t=a.readyState;"loaded"!==t&&"complete"!==t||(a.onreadystatechange=null,e())}:a.onload=e),n.appendChild(a)}("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:"cyrJmJ3rL",conf:t})})}}()</script><script type="text/javascript" src="https://assets.changyan.sohu.com/upload/plugins/plugins.count.js"></script><script type="text/javascript">var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")};function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var searchFunc=function(t,e,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,r=document.getElementById(e),s=document.getElementById(o),a=function(){var t=r.value.trim().toLowerCase(),e=t.split(/[\s\-]+/);e.length>1&&e.push(t);var o=[];if(t.length>0&&n.forEach(function(n){var r=!1,s=0,a=0,i=n.title.trim(),c=i.toLowerCase(),l=n.content.trim().replace(/<[^>]+>/g,""),h=l.toLowerCase(),p=decodeURIComponent(n.url),u=[],f=[];if(""!=i&&(e.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());(s=e.indexOf(t,r))>-1;)a.push({position:s,word:t}),r=s+n;return a}u=u.concat(e(t,c,!1)),f=f.concat(e(t,h,!1))}),(u.length>0||f.length>0)&&(r=!0,s=u.length+f.length)),r){[u,f].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});function d(e,o,n,r){for(var s=r[r.length-1],i=s.position,c=s.word,l=[],h=0;i+c.length<=n&&0!=r.length;){c===t&&h++,l.push({position:i,length:c.length});var p=i+c.length;for(r.pop();0!=r.length&&(i=(s=r[r.length-1]).position,c=s.word,p>i);)r.pop()}return a+=h,{hits:l,start:o,end:n,searchTextCount:h}}var g=[];0!=u.length&&g.push(d(0,0,i.length,u));for(var v=[];0!=f.length;){var $=f[f.length-1],C=$.position,m=$.word,x=C-20,w=C+80;x<0&&(x=0),w<C+m.length&&(w=C+m.length),w>l.length&&(w=l.length),v.push(d(0,x,w,f))}v.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var y=parseInt("1");y>=0&&(v=v.slice(0,y));function T(t,e){var o="",n=e.start;return e.hits.forEach(function(e){o+=t.substring(n,e.position);var r=e.position+e.length;o+='<b class="search-keyword">'+t.substring(e.position,r)+"</b>",n=r}),o+=t.substring(n,e.end)}var b="";0!=g.length?b+="<li><a href='"+p+"' class='search-result-title'>"+T(i,g[0])+"</a>":b+="<li><a href='"+p+"' class='search-result-title'>"+i+"</a>",v.forEach(function(t){b+="<a href='"+p+'\'><p class="search-result">'+T(l,t)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:a,hitCount:s,id:o.length})}}),1===e.length&&""===e[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{o.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var a='<ul class="search-result-list">';o.forEach(function(t){a+=t.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),!1===isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){27===t.which&&$(".search-popup").is(":visible")&&onPopupClose()})</script><script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script><script>AV.initialize("2uqmIjYredIvFy6tEXbKG4Fj-gzGzoHsz","CWl1rE8cQlIseOg2Cq3hzxYi")</script><script>function showTime(e){var t=new AV.Query(e),n=[],o=$(".leancloud_visitors");o.each(function(){n.push($(this).attr("id").trim())}),t.containedIn("url",n),t.find().done(function(e){var t=".leancloud-visitors-count";if(0!==e.length){for(var i=0;i<e.length;i++){var s=e[i],r=s.get("url"),l=s.get("time"),c=document.getElementById(r);$(c).find(t).text(l)}for(i=0;i<n.length;i++){r=n[i],c=document.getElementById(r);var u=$(c).find(t);""==u.text()&&u.text(0)}}else o.find(t).text(0)}).fail(function(e,t){console.log("Error: "+t.code+" "+t.message)})}function addCount(e){var t=$(".leancloud_visitors"),n=t.attr("id").trim(),o=t.attr("data-flag-title").trim(),i=new AV.Query(e);i.equalTo("url",n),i.find({success:function(t){if(t.length>0){var i=t[0];i.fetchWhenSave(!0),i.increment("time"),i.save(null,{success:function(e){$(document.getElementById(n)).find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})}else{var s=new e,r=new AV.ACL;r.setPublicReadAccess(!0),r.setPublicWriteAccess(!0),s.setACL(r),s.set("title",o),s.set("url",n),s.set("time",1),s.save(null,{success:function(e){$(document.getElementById(n)).find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to create")}})}},error:function(e){console.log("Error:"+e.code+" "+e.message)}})}$(function(){var e=AV.Object.extend("Counter");1==$(".leancloud_visitors").length?addCount(e):$(".post-title-link").length>1&&showTime(e)})</script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={},pbOptions.iconStyle="default",pbOptions.boxForm="horizontal",pbOptions.position="bottomCenter",pbOptions.networks="Weibo,Wechat,Douban,QQZone,Twitter,Facebook",new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={},flOptions.iconStyle="default",flOptions.boxForm="horizontal",flOptions.position="middleRight",flOptions.networks="Weibo,Wechat,Douban,QQZone,Twitter,Facebook",new needShareButton("#needsharebutton-float",flOptions)</script><script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script><script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script><script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script><div id="hexo-helper-live2d"><canvas id="live2dcanvas" width="150" height="300"></canvas></div><style>#live2dcanvas{position:fixed;width:150px;height:300px;opacity:.7;right:-30px;z-index:999;pointer-events:none;bottom:40px}</style><script type="text/javascript" src="/live2d/device.min.js"></script><script type="text/javascript">
const loadScript = function loadScript(c,b){var a=document.createElement("script");a.type="text/javascript";"undefined"!=typeof b&&(a.readyState?a.onreadystatechange=function(){if("loaded"==a.readyState||"complete"==a.readyState)a.onreadystatechange=null,b()}:a.onload=function(){b()});a.src=c;document.body.appendChild(a)};
(function(){
  if((typeof(device) != 'undefined') && (device.mobile())){
    var trElement = document.getElementById('hexo-helper-live2d');
    trElement.parentNode.removeChild(trElement);
    return;
  }else
    if (typeof(device) === 'undefined') console.error('Cannot find current-device script.');
  loadScript("/live2d/script.js", function(){loadlive2d("live2dcanvas", "/live2d/assets/hijiki.model.json", 0.5);});
})();
</script></body></html><script type="text/javascript" src="/js/src/love.js"></script>